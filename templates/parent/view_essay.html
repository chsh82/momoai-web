{% extends "base.html" %}

{% block title %}{{ essay.title }} - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('parent.essays', student_id=student.student_id) }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ì²¨ì‚­ ëª©ë¡ìœ¼ë¡œ
        </a>
        <div class="flex items-start justify-between">
            <div class="flex-1">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">{{ essay.title }}</h2>
                <div class="flex items-center gap-3 text-sm text-gray-600">
                    <span>ğŸ‘¤ {{ student.name }}</span>
                    <span>ğŸ“… {{ essay.created_at.strftime('%Yë…„ %mì›” %dì¼') }}</span>
                    <span>ğŸ‘¨â€ğŸ« {{ essay.user.name }} ê°•ì‚¬</span>
                </div>
            </div>
            <span class="px-4 py-2 text-sm font-medium rounded
                {% if essay.is_finalized %}bg-green-100 text-green-800
                {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                {% if essay.is_finalized %}ì²¨ì‚­ ì™„ë£Œ{% else %}ì§„í–‰ ì¤‘{% endif %}
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- ë³¸ë¬¸ -->
        <div class="lg:col-span-2 space-y-6">
            <!-- ì œì¶œí•œ ì›ë¬¸ -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">ì œì¶œí•œ ì›ë¬¸</h3>
                </div>
                <div class="p-6">
                    <div class="prose max-w-none whitespace-pre-wrap">
                        {{ essay.essay_content }}
                    </div>

                    <!-- ì²¨ë¶€ íŒŒì¼ -->
                    {% if essay.attachment_filename %}
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <div class="flex items-center bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <span class="text-2xl mr-3">ğŸ“</span>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-700">ì²¨ë¶€ íŒŒì¼</div>
                                <div class="text-sm text-gray-600">{{ essay.attachment_filename }}</div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- ì²¨ì‚­ ê²°ê³¼ -->
            {% if essay.is_finalized %}
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">ì²¨ì‚­ ê²°ê³¼</h3>
                </div>
                <div class="p-6">
                    {% if essay.overall_feedback %}
                    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-bold text-blue-900 mb-2">ğŸ’¬ ì¢…í•© í‰ê°€</h4>
                        <p class="text-gray-700 whitespace-pre-wrap">{{ essay.overall_feedback }}</p>
                    </div>
                    {% endif %}

                    {% if essay.strengths %}
                    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-bold text-green-900 mb-2">âœ¨ ì˜í•œ ì </h4>
                        <p class="text-gray-700 whitespace-pre-wrap">{{ essay.strengths }}</p>
                    </div>
                    {% endif %}

                    {% if essay.improvements %}
                    <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-bold text-yellow-900 mb-2">ğŸ“ˆ ê°œì„ í•  ì </h4>
                        <p class="text-gray-700 whitespace-pre-wrap">{{ essay.improvements }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="bg-white rounded-lg shadow p-8 text-center">
                <div class="text-5xl mb-3">â³</div>
                <p class="text-gray-600">ì²¨ì‚­ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì™„ë£Œë˜ë©´ ì•Œë¦¼ì„ í†µí•´ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div class="space-y-6">
            <!-- í‰ê°€ ì ìˆ˜ -->
            {% if essay.is_finalized %}
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800">í‰ê°€ ì ìˆ˜</h3>
                </div>
                <div class="p-6">
                    {% if essay.total_score %}
                    <div class="text-center mb-4 pb-4 border-b border-gray-200">
                        <div class="text-4xl font-bold text-blue-600 mb-1">{{ essay.total_score }}</div>
                        <div class="text-sm text-gray-600">ì´ì </div>
                    </div>
                    {% endif %}

                    {% if essay.content_score or essay.structure_score or essay.expression_score %}
                    <div class="space-y-3">
                        {% if essay.content_score %}
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">ë‚´ìš©</span>
                            <span class="font-medium text-gray-800">{{ essay.content_score }}ì </span>
                        </div>
                        {% endif %}
                        {% if essay.structure_score %}
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">êµ¬ì¡°</span>
                            <span class="font-medium text-gray-800">{{ essay.structure_score }}ì </span>
                        </div>
                        {% endif %}
                        {% if essay.expression_score %}
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">í‘œí˜„</span>
                            <span class="font-medium text-gray-800">{{ essay.expression_score }}ì </span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- ì œì¶œ ì •ë³´ -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800">ì œì¶œ ì •ë³´</h3>
                </div>
                <div class="p-6 space-y-3 text-sm">
                    <div>
                        <span class="text-gray-600">í•™ìƒ</span>
                        <div class="font-medium text-gray-800">{{ student.name }} ({{ student.grade }})</div>
                    </div>
                    <div>
                        <span class="text-gray-600">ë‹´ë‹¹ ê°•ì‚¬</span>
                        <div class="font-medium text-gray-800">{{ essay.user.name }}</div>
                    </div>
                    <div>
                        <span class="text-gray-600">ì œì¶œì¼</span>
                        <div class="font-medium text-gray-800">{{ essay.created_at.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }}</div>
                    </div>
                    {% if essay.is_finalized %}
                    <div>
                        <span class="text-gray-600">ì™„ë£Œì¼</span>
                        <div class="font-medium text-gray-800">{{ essay.finalized_at.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
