{% extends "base.html" %}

{% block title %}{{ student.name }} ê²°ì œ ê´€ë¦¬ - MOMOAI v4.0{% endblock %}

{% block page_title %}ğŸ’° ê²°ì œ ìƒì„¸{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('parent.child_detail', student_id=student.student_id) }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† {{ student.name }} ì •ë³´ë¡œ
        </a>
        <h2 class="text-3xl font-bold text-gray-800">{{ student.name }} ê²°ì œ ê´€ë¦¬</h2>
    </div>

    <!-- ì „ì²´ í†µê³„ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì´ ë‚©ë¶€ ê¸ˆì•¡</p>
                    <p class="text-3xl font-bold text-green-600">{{ "{:,}".format(total_paid) }}ì›</p>
                </div>
                <div class="text-green-600 text-4xl">ğŸ’³</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ë¯¸ë‚© ê¸ˆì•¡</p>
                    <p class="text-3xl font-bold text-red-600">{{ "{:,}".format(total_unpaid) }}ì›</p>
                </div>
                <div class="text-red-600 text-4xl">âš ï¸</div>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì—…ë³„ ê²°ì œ ì •ë³´ -->
    <div class="space-y-6">
        {% for data in payment_data %}
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800">{{ data.course.course_name }}</h3>
                    <span class="px-3 py-1 text-sm font-medium rounded
                        {% if data.calculation.remaining_amount == 0 %}bg-green-100 text-green-800
                        {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                        {% if data.calculation.remaining_amount == 0 %}ì™„ë‚©
                        {% else %}ë¯¸ë‚© ìˆìŒ{% endif %}
                    </span>
                </div>
            </div>
            <div class="p-6">
                <!-- ê²°ì œ ì •ë³´ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <p class="text-xs text-gray-600 mb-1">ì´ ìˆ˜ì—…ë£Œ</p>
                        <p class="text-lg font-bold text-blue-600">{{ "{:,}".format(data.calculation.total_amount) }}ì›</p>
                        <p class="text-xs text-gray-500 mt-1">ì¶œì„ {{ data.enrollment.attended_sessions + data.enrollment.late_sessions }}íšŒ ê¸°ì¤€</p>
                    </div>

                    <div class="bg-green-50 rounded-lg p-4">
                        <p class="text-xs text-gray-600 mb-1">ë‚©ë¶€ ì™„ë£Œ</p>
                        <p class="text-lg font-bold text-green-600">{{ "{:,}".format(data.calculation.paid_amount) }}ì›</p>
                        <p class="text-xs text-gray-500 mt-1">{{ data.enrollment.paid_sessions }}íšŒ ê²°ì œ</p>
                    </div>

                    <div class="bg-yellow-50 rounded-lg p-4">
                        <p class="text-xs text-gray-600 mb-1">ë¯¸ë‚© ê¸ˆì•¡</p>
                        <p class="text-lg font-bold text-yellow-600">{{ "{:,}".format(data.calculation.remaining_amount) }}ì›</p>
                        <p class="text-xs text-gray-500 mt-1">ì¶œì„ ë¯¸ë‚© {{ data.calculation.attended_unpaid }}íšŒ</p>
                    </div>

                    <div class="bg-purple-50 rounded-lg p-4">
                        <p class="text-xs text-gray-600 mb-1">íšŒë‹¹ ìˆ˜ì—…ë£Œ</p>
                        <p class="text-lg font-bold text-purple-600">{{ "{:,}".format(data.course.price_per_session) }}ì›</p>
                        <p class="text-xs text-gray-500 mt-1">ì´ {{ data.course.total_sessions }}íšŒ</p>
                    </div>
                </div>

                <!-- ê²°ì œ ë‚´ì—­ -->
                {% if data.payments %}
                <div>
                    <h4 class="font-medium text-gray-800 mb-3">ê²°ì œ ë‚´ì—­</h4>
                    <div class="space-y-2">
                        {% for payment in data.payments %}
                        <div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="font-medium text-gray-800">{{ "{:,}".format(payment.amount) }}ì›</span>
                                    <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded">
                                        {% if payment.payment_type == 'tuition' %}ìˆ˜ì—…ë£Œ
                                        {% elif payment.payment_type == 'registration' %}ë“±ë¡ë¹„
                                        {% elif payment.payment_type == 'material' %}êµì¬ë¹„
                                        {% endif %}
                                    </span>
                                    {% if payment.payment_method %}
                                    <span class="text-xs text-gray-500">
                                        {{ payment.payment_method }}
                                    </span>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-gray-600">
                                    {{ payment.paid_at.strftime('%Yë…„ %mì›” %dì¼') if payment.paid_at else payment.created_at.strftime('%Yë…„ %mì›” %dì¼') }}
                                    {% if payment.sessions_covered > 0 %} | {{ payment.sessions_covered }}íšŒ ë¶„{% endif %}
                                </p>
                            </div>
                            <span class="px-3 py-1 text-xs font-medium bg-green-100 text-green-800 rounded">
                                ì™„ë£Œ
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-4">ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% if total_unpaid > 0 %}
    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <div class="flex items-start gap-3">
            <span class="text-2xl">ğŸ’¡</span>
            <div>
                <h4 class="font-medium text-yellow-900 mb-1">ê²°ì œ ì•ˆë‚´</h4>
                <p class="text-sm text-yellow-800 mb-2">
                    ë¯¸ë‚© ê¸ˆì•¡ì´ ìˆìŠµë‹ˆë‹¤. í•™ì› ê´€ë¦¬ìì—ê²Œ ì—°ë½í•˜ì—¬ ê²°ì œë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.
                </p>
                <p class="text-xs text-yellow-700">
                    * ê²°ì œëŠ” ì¶œì„í•œ íšŒì°¨ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
