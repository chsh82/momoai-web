{% extends "base.html" %}

{% block title %}ë‚´ ìë…€ - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">ë‚´ ìë…€ ({{ children_data|length }}ëª…)</h2>

    <!-- ìë…€ ëª©ë¡ -->
    {% if children_data %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for data in children_data %}
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition duration-200">
            <div class="p-6">
                <!-- í•™ìƒ ì •ë³´ -->
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-16 h-16 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-2xl">
                        {{ data.student.name[0] }}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-lg font-bold text-gray-800">{{ data.student.name }}</h3>
                            {% if data.student.tier %}
                            <span class="px-2 py-1 text-xs font-medium rounded
                                {% if data.student.tier == 'A' %}bg-red-100 text-red-800
                                {% elif data.student.tier == 'B' %}bg-blue-100 text-blue-800
                                {% elif data.student.tier == 'C' %}bg-green-100 text-green-800
                                {% elif data.student.tier == 'VIP' %}bg-purple-100 text-purple-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ data.student.tier }}
                            </span>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-600">{{ data.student.grade }}</p>
                    </div>
                </div>

                <!-- í†µê³„ -->
                <div class="space-y-3 mb-4">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600">ğŸ“š ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…</span>
                        <span class="font-medium text-gray-800">{{ data.enrollments|length }}ê°œ</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600">ğŸ“Š í‰ê·  ì¶œì„ë¥ </span>
                        <span class="font-medium text-gray-800">{{ "%.1f"|format(data.avg_attendance_rate) }}%</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600">ğŸ“¬ ì½ì§€ ì•Šì€ í”¼ë“œë°±</span>
                        <span class="font-medium {% if data.unread_feedbacks > 0 %}text-yellow-600{% else %}text-gray-800{% endif %}">
                            {{ data.unread_feedbacks }}ê°œ
                        </span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600">ğŸ’° ë¯¸ë‚© ê¸ˆì•¡</span>
                        <span class="font-medium {% if data.unpaid_amount > 0 %}text-red-600{% else %}text-gray-800{% endif %}">
                            {{ "{:,}".format(data.unpaid_amount) }}ì›
                        </span>
                    </div>
                </div>

                <!-- ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—… -->
                {% if data.enrollments %}
                <div class="mb-4">
                    <p class="text-xs text-gray-600 mb-2">ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…:</p>
                    <div class="flex flex-wrap gap-1">
                        {% for enrollment in data.enrollments %}
                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded">
                            {{ enrollment.course.course_name }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- ë²„íŠ¼ -->
                <div class="grid grid-cols-2 gap-2">
                    <a href="{{ url_for('parent.child_detail', student_id=data.student.student_id) }}"
                       class="bg-blue-600 hover:bg-blue-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                        ìƒì„¸ ì •ë³´
                    </a>
                    <a href="{{ url_for('parent.child_feedback', student_id=data.student.student_id) }}"
                       class="bg-yellow-600 hover:bg-yellow-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200 relative">
                        í”¼ë“œë°±
                        {% if data.unread_feedbacks > 0 %}
                        <span class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                            {{ data.unread_feedbacks }}
                        </span>
                        {% endif %}
                    </a>
                    <a href="{{ url_for('parent.child_attendance', student_id=data.student.student_id) }}"
                       class="bg-green-600 hover:bg-green-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                        ì¶œì„ í™•ì¸
                    </a>
                    <a href="{{ url_for('parent.child_payments', student_id=data.student.student_id) }}"
                       class="bg-purple-600 hover:bg-purple-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                        ê²°ì œ ê´€ë¦¬
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500 text-lg mb-4">ë“±ë¡ëœ ìë…€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <p class="text-gray-400 text-sm">í•™ì› ê´€ë¦¬ìì—ê²Œ ìë…€ ë“±ë¡ì„ ìš”ì²­í•˜ì„¸ìš”.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
