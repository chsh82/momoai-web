{% extends "base.html" %}

{% block title %}ê²€ìƒ‰ - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ” í†µí•© ê²€ìƒ‰</h2>

    <!-- ê²€ìƒ‰ í¼ -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <form method="GET" action="{{ url_for('search.index') }}">
            <div class="flex gap-4">
                <div class="flex-1">
                    <input type="text" name="q" value="{{ query }}"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="í•™ìƒ, ìˆ˜ì—…, ìë£Œ, ê³¼ì œ ë“±ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." autofocus>
                </div>
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-8 py-3 rounded-lg transition duration-200">
                    ê²€ìƒ‰
                </button>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
            <div class="flex gap-2 mt-4">
                <label class="flex items-center">
                    <input type="radio" name="category" value="all" {% if category == 'all' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">ì „ì²´</span>
                </label>
                {% if current_user.role in ['admin', 'teacher'] %}
                <label class="flex items-center">
                    <input type="radio" name="category" value="students" {% if category == 'students' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">í•™ìƒ</span>
                </label>
                {% endif %}
                <label class="flex items-center">
                    <input type="radio" name="category" value="courses" {% if category == 'courses' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">ìˆ˜ì—…</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="category" value="materials" {% if category == 'materials' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">í•™ìŠµìë£Œ</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="category" value="assignments" {% if category == 'assignments' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">ê³¼ì œ</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="category" value="posts" {% if category == 'posts' %}checked{% endif %}
                           class="mr-2" onchange="this.form.submit()">
                    <span class="text-sm text-gray-700">ê²Œì‹œê¸€</span>
                </label>
            </div>
        </form>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
    {% if query %}
        <!-- í•™ìƒ ê²°ê³¼ -->
        {% if results.students %}
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">ğŸ‘¨â€ğŸ“ í•™ìƒ ({{ results.students|length }})</h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for student in results.students %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">{{ student.name }}</h4>
                                <p class="text-sm text-gray-600">{{ student.grade }} | {{ student.email }}</p>
                            </div>
                            <a href="{{ url_for('students.detail', student_id=student.student_id) }}"
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                ìƒì„¸ë³´ê¸° â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ìˆ˜ì—… ê²°ê³¼ -->
        {% if results.courses %}
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">ğŸ“š ìˆ˜ì—… ({{ results.courses|length }})</h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for course in results.courses %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <h4 class="font-medium text-gray-800">{{ course.course_name }}</h4>
                                    {% if course.tier %}
                                    <span class="px-2 py-0.5 text-xs font-medium rounded
                                        {% if course.tier == 'A' %}bg-red-100 text-red-800
                                        {% elif course.tier == 'B' %}bg-blue-100 text-blue-800
                                        {% elif course.tier == 'VIP' %}bg-purple-100 text-purple-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {{ course.tier }}
                                    </span>
                                    {% endif %}
                                </div>
                                <p class="text-sm text-gray-600">{{ course.teacher.name }} ê°•ì‚¬ | {{ course.enrolled_count }}ëª… ìˆ˜ê°•</p>
                            </div>
                            <a href="{% if current_user.role == 'admin' %}{{ url_for('admin.course_detail', course_id=course.course_id) }}{% elif current_user.role == 'teacher' %}{{ url_for('teacher.course_detail', course_id=course.course_id) }}{% else %}{{ url_for('student.course_detail', course_id=course.course_id) }}{% endif %}"
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                ìƒì„¸ë³´ê¸° â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- í•™ìŠµ ìë£Œ ê²°ê³¼ -->
        {% if results.materials %}
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">ğŸ“ í•™ìŠµ ìë£Œ ({{ results.materials|length }})</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for material in results.materials %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-800 mb-1">{{ material.title }}</h4>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-xs px-2 py-0.5 bg-blue-100 text-blue-800 rounded">
                                        {{ material.file_type.upper() }}
                                    </span>
                                    <span class="text-xs text-gray-500">{{ material.file_size_mb }}MB</span>
                                </div>
                                {% if current_user.role == 'student' %}
                                <a href="{{ url_for('student.download_material', material_id=material.material_id) }}"
                                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                    ë‹¤ìš´ë¡œë“œ â†’
                                </a>
                                {% else %}
                                <p class="text-xs text-gray-500">ë‹¤ìš´ë¡œë“œ: {{ material.download_count }}íšŒ</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ê³¼ì œ ê²°ê³¼ -->
        {% if results.assignments %}
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">ğŸ“ ê³¼ì œ ({{ results.assignments|length }})</h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for assignment in results.assignments %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">{{ assignment.title }}</h4>
                                <p class="text-sm text-gray-600">
                                    {% if assignment.course %}{{ assignment.course.course_name }} | {% endif %}
                                    ë§ˆê°: {{ assignment.due_date.strftime('%m/%d %H:%M') }} | ë°°ì : {{ assignment.max_score }}ì 
                                </p>
                            </div>
                            <a href="{% if current_user.role in ['admin', 'teacher'] %}{{ url_for('teacher.assignment_detail', assignment_id=assignment.assignment_id) }}{% else %}{{ url_for('student.assignment_detail', assignment_id=assignment.assignment_id) }}{% endif %}"
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                ë³´ê¸° â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ê²Œì‹œê¸€ ê²°ê³¼ -->
        {% if results.posts %}
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">ğŸ’¬ ê²Œì‹œê¸€ ({{ results.posts|length }})</h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for post in results.posts %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">{{ post.title }}</h4>
                                <p class="text-sm text-gray-600">{{ post.user.name }} | {{ post.created_at.strftime('%Y-%m-%d') }} | ì¡°íšŒ {{ post.views }}</p>
                            </div>
                            <a href="{{ url_for('community.detail', post_id=post.post_id) }}"
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                ë³´ê¸° â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ê²°ê³¼ ì—†ìŒ -->
        {% if not results.students and not results.courses and not results.materials and not results.assignments and not results.posts %}
        <div class="bg-white rounded-lg shadow p-12 text-center">
            <div class="text-6xl mb-4">ğŸ”</div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-gray-600">"{{ query }}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        {% endif %}
    {% else %}
        <!-- ì´ˆê¸° í™”ë©´ -->
        <div class="bg-white rounded-lg shadow p-12 text-center">
            <div class="text-6xl mb-4">ğŸ”</div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">ë¬´ì—‡ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?</h3>
            <p class="text-gray-600">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì—¬ í•™ìƒ, ìˆ˜ì—…, ìë£Œ, ê³¼ì œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
