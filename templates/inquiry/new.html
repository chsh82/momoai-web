{% extends "base.html" %}

{% block title %}ë¬¸ì˜ ì‘ì„± - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="mb-6">
        <a href="{{ url_for('inquiry.index') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ë¬¸ì˜ ëª©ë¡ìœ¼ë¡œ
        </a>
        <h2 class="text-3xl font-bold text-gray-800">ğŸ“¬ ë¬¸ì˜ ì‘ì„±</h2>
        <p class="text-gray-500 mt-1 text-sm">ë¬¸ì˜í•˜ì‹  ë‚´ìš©ì€ ì„ íƒí•˜ì‹  ìˆ˜ì‹ ìê°€ í™•ì¸ í›„ ë‹µë³€ë“œë¦½ë‹ˆë‹¤.</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <form method="POST" action="{{ url_for('inquiry.new_inquiry') }}" id="inquiryForm">

            <!-- ìˆ˜ì‹ ì ì„ íƒ -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    ìˆ˜ì‹ ì <span class="text-red-500">*</span>
                </label>
                <div class="flex gap-3 mb-3">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="recipient_type" value="admin" checked
                               class="mr-2" onchange="toggleRecipient()">
                        <span class="px-4 py-2 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-medium text-sm" id="adminLabel">
                            ğŸ« ê´€ë¦¬ìì—ê²Œ
                        </span>
                    </label>
                    <label class="flex items-center cursor-pointer {% if not teachers_data %}opacity-40{% endif %}">
                        <input type="radio" name="recipient_type" value="teacher"
                               class="mr-2" onchange="toggleRecipient()"
                               {% if not teachers_data %}disabled{% endif %}>
                        <span class="px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg font-medium text-sm" id="teacherLabel">
                            ğŸ‘©â€ğŸ« ë‹´ë‹¹ ê°•ì‚¬ì—ê²Œ
                        </span>
                    </label>
                </div>

                <!-- ê°•ì‚¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ (ê¸°ë³¸ ìˆ¨ê¹€) -->
                <div id="teacherSelectBox" style="display:none;" class="mt-3">
                    {% if teachers_data %}
                    <select name="recipient_id" id="recipient_id"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white">
                        <option value="">â€” ê°•ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” â€”</option>
                        {% for t in teachers_data %}
                        <option value="{{ t.user.user_id }}">
                            {{ t.user.name }} ì„ ìƒë‹˜
                            ({{ t.course_names | join(', ') }})
                        </option>
                        {% endfor %}
                    </select>
                    {% else %}
                    <p class="text-sm text-gray-500 bg-gray-50 rounded-lg p-3">
                        í˜„ì¬ ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ì—†ì–´ ê°•ì‚¬ ì„ íƒì´ ë¶ˆê°€í•©ë‹ˆë‹¤.
                    </p>
                    {% endif %}
                </div>

                {% if not teachers_data %}
                <p class="text-xs text-gray-400 mt-2">ìë…€ê°€ ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ì—†ì–´ ê´€ë¦¬ìì—ê²Œë§Œ ë¬¸ì˜ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                {% endif %}
            </div>

            <!-- ì œëª© -->
            <div class="mb-5">
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                    ì œëª© <span class="text-red-500">*</span>
                </label>
                <input type="text" id="title" name="title" required
                       value="{{ title_val }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
            </div>

            <!-- ë‚´ìš© -->
            <div class="mb-5">
                <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                    ë‚´ìš© <span class="text-red-500">*</span>
                </label>
                <textarea id="content" name="content" rows="10" required
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ìƒì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”">{{ content_val }}</textarea>
            </div>

            <!-- ë²„íŠ¼ -->
            <div class="flex gap-3">
                <button type="submit"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition">
                    ë¬¸ì˜ ë“±ë¡í•˜ê¸°
                </button>
                <a href="{{ url_for('inquiry.index') }}"
                   class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 rounded-lg transition text-center">
                    ì·¨ì†Œ
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function toggleRecipient() {
    const type = document.querySelector('input[name="recipient_type"]:checked').value;
    const teacherBox = document.getElementById('teacherSelectBox');
    const adminLabel = document.getElementById('adminLabel');
    const teacherLabel = document.getElementById('teacherLabel');

    if (type === 'teacher') {
        teacherBox.style.display = 'block';
        adminLabel.className = 'px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg font-medium text-sm';
        teacherLabel.className = 'px-4 py-2 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-medium text-sm';
    } else {
        teacherBox.style.display = 'none';
        adminLabel.className = 'px-4 py-2 border-2 border-blue-500 bg-blue-50 text-blue-700 rounded-lg font-medium text-sm';
        teacherLabel.className = 'px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-lg font-medium text-sm';
        // ê°•ì‚¬ ì„ íƒ ì´ˆê¸°í™”
        const sel = document.getElementById('recipient_id');
        if (sel) sel.value = '';
    }
}
</script>
{% endblock %}
