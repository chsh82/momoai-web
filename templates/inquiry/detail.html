{% extends "base.html" %}

{% block title %}{{ post.title }} - ë¬¸ì˜ ê²Œì‹œíŒ - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('inquiry.index') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ë¬¸ì˜ ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>

    <!-- ë¬¸ì˜ ë‚´ìš© -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        {% if post.is_private %}
                        <span class="text-gray-400 text-sm">ğŸ”’ ë¹„ê³µê°œ</span>
                        {% endif %}
                        {% if post.status == 'answered' %}
                        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-800">âœ… ë‹µë³€ì™„ë£Œ</span>
                        {% else %}
                        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">â³ ë‹µë³€ëŒ€ê¸°</span>
                        {% endif %}
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">{{ post.title }}</h2>
                    <div class="flex items-center gap-3 mt-2 text-sm text-gray-500">
                        <span>{{ post.author.name }}</span>
                        <span class="text-gray-300">|</span>
                        <span>ìˆ˜ì‹ :
                            {% if post.recipient %}
                                <span class="font-medium text-indigo-600">{{ post.recipient.name }} ì„ ìƒë‹˜</span>
                            {% else %}
                                <span class="font-medium text-blue-600">ê´€ë¦¬ì</span>
                            {% endif %}
                        </span>
                        <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                </div>
                {% if current_user.user_id == post.author_id or current_user.role == 'admin' %}
                <form method="POST" action="{{ url_for('inquiry.delete_inquiry', inquiry_id=post.inquiry_id) }}"
                      onsubmit="return confirm('ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                    <button type="submit"
                            class="text-red-500 hover:text-red-700 text-sm font-medium px-3 py-1 border border-red-300 rounded hover:bg-red-50 transition">
                        ì‚­ì œ
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        <div class="px-6 py-5">
            <div class="text-gray-700 whitespace-pre-wrap leading-relaxed">{{ post.content }}</div>
        </div>
    </div>

    <!-- ë‹µë³€ ëª©ë¡ -->
    {% if post.replies %}
    <div class="space-y-4 mb-6">
        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide px-1">
            ë‹µë³€ {{ post.replies|length }}ê°œ
        </h3>
        {% for r in post.replies %}
        <div class="bg-blue-50 border border-blue-200 rounded-lg">
            <div class="px-5 py-3 border-b border-blue-100 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="text-blue-700 font-medium text-sm">ğŸ’¬ {{ r.author.name }}</span>
                    <span class="text-xs text-gray-500 bg-white border border-gray-200 px-2 py-0.5 rounded-full">
                        {{ 'ê´€ë¦¬ì' if r.author.role == 'admin' else 'ê°•ì‚¬' }}
                    </span>
                </div>
                <span class="text-xs text-gray-400">{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
            <div class="px-5 py-4">
                <div class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm">{{ r.content }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ë‹µë³€ ì‘ì„± (ê´€ë¦¬ì/ê°•ì‚¬ë§Œ) -->
    {% if current_user.role in ('admin', 'teacher') %}
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-bold text-gray-800">
                {% if post.replies %}ì¶”ê°€ ë‹µë³€ ì‘ì„±{% else %}ë‹µë³€ ì‘ì„±{% endif %}
            </h3>
        </div>
        <div class="px-6 py-5">
            <form method="POST" action="{{ url_for('inquiry.reply', inquiry_id=post.inquiry_id) }}">
                <div class="mb-4">
                    <textarea name="content" rows="6" required
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="ë‹µë³€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
                </div>
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2.5 rounded-lg transition">
                    ë‹µë³€ ë“±ë¡
                </button>
            </form>
        </div>
    </div>
    {% else %}
    {% if not post.replies %}
    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
        <p class="text-gray-500">ì•„ì§ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤. ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
