{% extends "base.html" %}

{% block title %}{{ book.title }} - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('books.index') }}" class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ë„ì„œ ëª©ë¡ìœ¼ë¡œ
        </a>
        <div class="flex items-center justify-between">
            <h2 class="text-3xl font-bold text-gray-800">ğŸ“– ë„ì„œ ìƒì„¸</h2>
            <div class="flex gap-2">
                <a href="{{ url_for('books.edit', book_id=book.book_id) }}"
                   class="bg-gray-600 hover:bg-gray-700 text-white font-medium px-6 py-2 rounded-lg transition duration-200">
                    ìˆ˜ì •
                </a>
                <button onclick="confirmDelete()"
                        class="bg-red-600 hover:bg-red-700 text-white font-medium px-6 py-2 rounded-lg transition duration-200">
                    ì‚­ì œ
                </button>
            </div>
        </div>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="mb-4 p-4 rounded-lg {% if category == 'error' %}bg-red-100 text-red-700{% elif category == 'success' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- ì™¼ìª½: ë„ì„œ ì •ë³´ -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <!-- í‘œì§€ ì´ë¯¸ì§€ -->
                <div class="mb-6">
                    <div class="h-64 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg flex items-center justify-center">
                        {% if book.cover_image_url %}
                        <img src="{{ book.cover_image_url }}" alt="{{ book.title }}" class="h-full w-full object-cover rounded-lg">
                        {% else %}
                        <div class="text-8xl">ğŸ“–</div>
                        {% endif %}
                    </div>
                </div>

                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="space-y-3">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">{{ book.title }}</h3>

                    {% if book.author %}
                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ì €ì</span>
                        <span class="text-gray-800 flex-1">{{ book.author }}</span>
                    </div>
                    {% endif %}

                    {% if book.publisher %}
                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ì¶œíŒì‚¬</span>
                        <span class="text-gray-800 flex-1">{{ book.publisher }}</span>
                    </div>
                    {% endif %}

                    {% if book.publication_year %}
                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ì¶œíŒë…„ë„</span>
                        <span class="text-gray-800 flex-1">{{ book.publication_year }}ë…„</span>
                    </div>
                    {% endif %}

                    {% if book.isbn %}
                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ISBN</span>
                        <span class="text-gray-800 flex-1 font-mono text-sm">{{ book.isbn }}</span>
                    </div>
                    {% endif %}

                    {% if book.category %}
                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ì¹´í…Œê³ ë¦¬</span>
                        <span class="inline-block px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 rounded-full">
                            {{ book.category }}
                        </span>
                    </div>
                    {% endif %}

                    <div class="flex items-start pt-3 border-t border-gray-200">
                        <span class="text-gray-600 font-medium w-20">ë“±ë¡ì¼</span>
                        <span class="text-gray-800 flex-1">{{ book.created_at.strftime('%Y-%m-%d') }}</span>
                    </div>

                    <div class="flex items-start">
                        <span class="text-gray-600 font-medium w-20">ë“±ë¡ì</span>
                        <span class="text-gray-800 flex-1">{{ book.user.name }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì„¤ëª… ë° ê´€ë ¨ ì²¨ì‚­ -->
        <div class="lg:col-span-2 space-y-6">
            <!-- ë„ì„œ ì„¤ëª… -->
            {% if book.description %}
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ ë„ì„œ ì„¤ëª…</h3>
                <div class="text-gray-700 whitespace-pre-wrap">{{ book.description }}</div>
            </div>
            {% endif %}

            <!-- ê´€ë ¨ ì²¨ì‚­ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        ğŸ“ ì´ ë„ì„œë¥¼ ì°¸ê³ í•œ ì²¨ì‚­
                        <span class="text-blue-600 ml-2">{{ essays|length }}ê±´</span>
                    </h3>
                </div>

                {% if essays %}
                <div class="space-y-3">
                    {% for essay in essays %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-400 transition duration-200">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <h4 class="text-lg font-medium text-gray-800">
                                        {{ essay.title or essay.student.name + 'ì˜ ë…¼ìˆ ' }}
                                    </h4>
                                    <span class="px-2 py-1 text-xs font-medium rounded-full
                                        {% if essay.status == 'completed' %}bg-green-100 text-green-800
                                        {% elif essay.status == 'processing' %}bg-blue-100 text-blue-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {% if essay.status == 'completed' %}ì™„ë£Œ
                                        {% elif essay.status == 'processing' %}ì²˜ë¦¬ ì¤‘
                                        {% else %}{{ essay.status }}{% endif %}
                                    </span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    ğŸ‘¤ {{ essay.student.name }} Â· ğŸ“… {{ essay.created_at.strftime('%Y-%m-%d') }}
                                </div>
                            </div>
                            {% if essay.status in ['reviewing', 'completed'] %}
                            <a href="{{ url_for('essays.result', essay_id=essay.essay_id) }}"
                               class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-4 py-2 rounded transition duration-200">
                                ë³´ê¸°
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">ğŸ“</div>
                    <p>ì´ ë„ì„œë¥¼ ì°¸ê³ í•œ ì²¨ì‚­ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation -->
<form id="deleteForm" method="POST" action="{{ url_for('books.delete', book_id=book.book_id) }}" style="display: none;">
</form>

<script>
function confirmDelete() {
    if (confirm('{{ book.title }}ì„(ë¥¼) ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê´€ë ¨ëœ ì²¨ì‚­ ì—°ê²°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
        document.getElementById('deleteForm').submit();
    }
}
</script>
{% endblock %}
