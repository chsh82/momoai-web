{% extends "base.html" %}

{% block title %}ì´ë¯¸ì§€ ì—…ë¡œë“œ - OCR ì¸ì‹ - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('essays.ocr_index') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† OCR ë©”ì¸ìœ¼ë¡œ
        </a>
        <h2 class="text-3xl font-bold text-gray-800 mb-2">ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
        <p class="text-gray-600">ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤</p>
    </div>

    <!-- ì•ˆë‚´ ì¹´ë“œ -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
        <div class="flex items-start gap-3">
            <span class="text-3xl">ğŸ’¡</span>
            <div>
                <h4 class="font-medium text-blue-900 mb-2">OCR ì‚¬ìš© ì•ˆë‚´</h4>
                <ul class="text-sm text-blue-800 space-y-1">
                    <li>â€¢ ì§€ì› í˜•ì‹: JPG, PNG, BMP, TIFF, GIF, WEBP</li>
                    <li>â€¢ í•œê¸€ê³¼ ì˜ì–´ í…ìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì¸ì‹í•©ë‹ˆë‹¤</li>
                    <li>â€¢ ì´ë¯¸ì§€ê°€ ì„ ëª…í• ìˆ˜ë¡ ì¸ì‹ë¥ ì´ ë†’ì•„ì§‘ë‹ˆë‹¤</li>
                    <li>â€¢ ì²˜ë¦¬ ì‹œê°„ì€ ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ 10~60ì´ˆ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ì—…ë¡œë“œ í¼ -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">ì´ë¯¸ì§€ ì„ íƒ</h3>
        </div>
        <div class="p-6">
            <form method="POST" action="{{ url_for('essays.ocr_upload') }}" enctype="multipart/form-data" onsubmit="return showProcessing()">
                <div class="mb-6">
                    <label for="image" class="block text-sm font-medium text-gray-700 mb-2">
                        ì´ë¯¸ì§€ íŒŒì¼ <span class="text-red-500">*</span>
                    </label>
                    <input type="file"
                           id="image"
                           name="image"
                           required
                           accept="image/*"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                           onchange="previewImage(this)">
                    <p class="mt-2 text-sm text-gray-500">
                        ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš” (ìµœëŒ€ í¬ê¸°: 16MB)
                    </p>
                </div>

                <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                <div id="preview-container" class="mb-6 hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¯¸ë¦¬ë³´ê¸°</label>
                    <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
                        <img id="preview-image" src="" alt="ë¯¸ë¦¬ë³´ê¸°" class="max-w-full h-auto max-h-96 mx-auto">
                    </div>
                </div>

                <div class="flex gap-3">
                    <button type="submit"
                            id="submit-button"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition duration-200">
                        OCR ì¸ì‹ ì‹œì‘
                    </button>
                    <a href="{{ url_for('essays.ocr_index') }}"
                       class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 rounded-lg transition duration-200 text-center">
                        ì·¨ì†Œ
                    </a>
                </div>
            </form>

            <!-- ì²˜ë¦¬ ì¤‘ ë©”ì‹œì§€ -->
            <div id="processing-message" class="hidden mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center gap-3">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-700"></div>
                    <div>
                        <h4 class="font-medium text-yellow-900">OCR ì²˜ë¦¬ ì¤‘...</h4>
                        <p class="text-sm text-yellow-800">ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    const container = document.getElementById('preview-container');
    const image = document.getElementById('preview-image');

    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
            image.src = e.target.result;
            container.classList.remove('hidden');
        };

        reader.readAsDataURL(input.files[0]);
    }
}

function showProcessing() {
    const button = document.getElementById('submit-button');
    const message = document.getElementById('processing-message');

    button.disabled = true;
    button.classList.add('opacity-50', 'cursor-not-allowed');
    message.classList.remove('hidden');

    return true;
}
</script>
{% endblock %}
