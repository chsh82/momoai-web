{% extends "base.html" %}

{% block title %}{{ result.mbti_type.type_name }} - ë…ì„œ ë…¼ìˆ  MBTI{% endblock %}

{% block page_title %}ğŸ¯ MBTI ê²°ê³¼{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">ë‚´ ë…ì„œë…¼ìˆ  ì„±í–¥</span>
{% endblock %}


{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <a href="{{ url_for('student.reading_mbti') }}"
               class="text-blue-600 hover:text-blue-800 font-medium">
                â† í…ŒìŠ¤íŠ¸ ëª©ë¡
            </a>
            <div class="text-sm text-gray-600">
                ê²€ì‚¬ì¼: {{ result.created_at.strftime('%Yë…„ %mì›” %dì¼') }}
            </div>
        </div>
    </div>

    <!-- ìœ í˜• ê²°ê³¼ ì¹´ë“œ -->
    <div class="bg-gradient-to-br from-purple-500 via-indigo-600 to-purple-700 rounded-lg shadow-xl p-8 text-white mb-8">
        <div class="text-center mb-8">
            <div class="text-6xl mb-4">ğŸ¯</div>
            <div class="text-4xl font-bold mb-2">{{ result.mbti_type.type_name }}</div>
            <div class="text-xl text-purple-100 mb-4">{{ result.mbti_type.combo_description }}</div>
            <div class="inline-block bg-white/20 rounded-full px-6 py-2 text-lg font-medium">
                {{ result.mbti_type.type_code }}
            </div>
        </div>

        <div class="bg-white/10 rounded-lg p-6 backdrop-blur-sm">
            <p class="text-lg leading-relaxed">
                {{ result.mbti_type.full_description }}
            </p>
        </div>
    </div>

    <!-- ì ìˆ˜ ì°¨íŠ¸ -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
            <span class="text-2xl">ğŸ“Š</span>
            ë‚˜ì˜ ì—­ëŸ‰ í”„ë¡œí•„
        </h3>

        <!-- ë ˆì´ë” ì°¨íŠ¸ -->
        <div class="mb-8">
            <div class="max-w-2xl mx-auto">
                <canvas id="radarChart" height="300"></canvas>
            </div>
        </div>

        <!-- ìƒì„¸ ì ìˆ˜ (ì ‘ê¸° ê°€ëŠ¥) -->
        <details class="mt-6">
            <summary class="cursor-pointer text-gray-700 font-medium hover:text-purple-600 transition">
                ğŸ“‹ ìƒì„¸ ì ìˆ˜ ë³´ê¸°
            </summary>
        <div class="space-y-6 mt-4">
            <!-- ë…í•´ ì˜ì—­ -->
            <div>
                <div class="font-medium text-gray-700 mb-3">ğŸ“– ë…í•´ë ¥ (ì½ê¸° ì—­ëŸ‰)</div>
                <div class="space-y-2">
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì´ˆê¸‰ (ê¸°ë³¸ ë¬¸í•´ë ¥)</span>
                            <span class="text-sm font-medium text-purple-600">
                                {{ result.scores.read.beginner }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-400 transition-all"
                                 style="width: {{ (result.scores.read.beginner / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì¤‘ê¸‰ (êµ¬ì¡°ì  ë…í•´)</span>
                            <span class="text-sm font-medium text-purple-600">
                                {{ result.scores.read.intermediate }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-500 transition-all"
                                 style="width: {{ (result.scores.read.intermediate / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ê³ ê¸‰ (ë¹„íŒì  ë…í•´)</span>
                            <span class="text-sm font-medium text-purple-600">
                                {{ result.scores.read.advanced }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-600 transition-all"
                                 style="width: {{ (result.scores.read.advanced / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-700">ë…í•´ë ¥ ì´ì </span>
                            <span class="text-base font-bold text-purple-600">
                                {{ result.scores.read.beginner + result.scores.read.intermediate + result.scores.read.advanced }}ì 
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ìˆ˜ì¤€:
                            {% set read_total = result.scores.read.beginner + result.scores.read.intermediate + result.scores.read.advanced %}
                            {% if read_total <= 25 %}ì´ˆê¸‰{% elif read_total <= 50 %}ì¤‘ê¸‰{% else %}ê³ ê¸‰{% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë°œí‘œ/í† ë¡  ì˜ì—­ -->
            <div>
                <div class="font-medium text-gray-700 mb-3">ğŸ’¬ ì‚¬ê³ ë ¥ (ë°œí‘œ/í† ë¡ )</div>
                <div class="space-y-2">
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì´ˆê¸‰ (ë‚´ìš© ì „ë‹¬)</span>
                            <span class="text-sm font-medium text-indigo-600">
                                {{ result.scores.speech.beginner }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-400 transition-all"
                                 style="width: {{ (result.scores.speech.beginner / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì¤‘ê¸‰ (ë…¼ë¦¬ì  í‘œí˜„)</span>
                            <span class="text-sm font-medium text-indigo-600">
                                {{ result.scores.speech.intermediate }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-500 transition-all"
                                 style="width: {{ (result.scores.speech.intermediate / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ê³ ê¸‰ (ì°½ì˜ì  í™•ì¥)</span>
                            <span class="text-sm font-medium text-indigo-600">
                                {{ result.scores.speech.advanced }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-600 transition-all"
                                 style="width: {{ (result.scores.speech.advanced / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-700">ì‚¬ê³ ë ¥ ì´ì </span>
                            <span class="text-base font-bold text-indigo-600">
                                {{ result.scores.speech.beginner + result.scores.speech.intermediate + result.scores.speech.advanced }}ì 
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ìˆ˜ì¤€:
                            {% set speech_total = result.scores.speech.beginner + result.scores.speech.intermediate + result.scores.speech.advanced %}
                            {% if speech_total <= 25 %}ì´ˆê¸‰{% elif speech_total <= 50 %}ì¤‘ê¸‰{% else %}ê³ ê¸‰{% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì„œìˆ ë ¥ ì˜ì—­ -->
            <div>
                <div class="font-medium text-gray-700 mb-3">âœï¸ ì„œìˆ ë ¥ (ê¸€ì“°ê¸° ì—­ëŸ‰)</div>
                <div class="space-y-2">
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì´ˆê¸‰ (ê°„ê²°í•œ ìš”ì•½)</span>
                            <span class="text-sm font-medium text-pink-600">
                                {{ result.scores.write.beginner }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-pink-400 transition-all"
                                 style="width: {{ (result.scores.write.beginner / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ì¤‘ê¸‰ (ì²´ê³„ì  êµ¬ì„±)</span>
                            <span class="text-sm font-medium text-pink-600">
                                {{ result.scores.write.intermediate }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-pink-500 transition-all"
                                 style="width: {{ (result.scores.write.intermediate / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm text-gray-600">ê³ ê¸‰ (ì°½ì˜ì  ì¬êµ¬ì„±)</span>
                            <span class="text-sm font-medium text-pink-600">
                                {{ result.scores.write.advanced }}ì  / 25ì 
                            </span>
                        </div>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-pink-600 transition-all"
                                 style="width: {{ (result.scores.write.advanced / 25 * 100) }}%"></div>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-700">ì„œìˆ ë ¥ ì´ì </span>
                            <span class="text-base font-bold text-pink-600">
                                {{ result.scores.write.beginner + result.scores.write.intermediate + result.scores.write.advanced }}ì 
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ìˆ˜ì¤€:
                            {% set write_total = result.scores.write.beginner + result.scores.write.intermediate + result.scores.write.advanced %}
                            {% if write_total <= 25 %}ì´ˆê¸‰{% elif write_total <= 50 %}ì¤‘ê¸‰{% else %}ê³ ê¸‰{% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </details>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- ë…í•´ ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ“–</span>
                ë…í•´ ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ result.mbti_type.reading_style }}
            </p>
        </div>

        <!-- ë°œí‘œ/í† ë¡  ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ’¬</span>
                ë°œí‘œ/í† ë¡  ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ result.mbti_type.speaking_style }}
            </p>
        </div>

        <!-- ì“°ê¸° ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">âœï¸</span>
                ì“°ê¸° ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ result.mbti_type.writing_style }}
            </p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- ê°•ì  -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
            <h4 class="text-lg font-bold text-green-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ’ª</span>
                ê°•ì 
            </h4>
            <ul class="space-y-2">
                {% for strength in result.mbti_type.strengths %}
                <li class="flex items-start gap-2 text-green-700">
                    <span class="text-green-600 mt-1">âœ“</span>
                    <span>{{ strength }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- ì•½ì  -->
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-6">
            <h4 class="text-lg font-bold text-orange-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">âš ï¸</span>
                ë³´ì™„í•  ì 
            </h4>
            <ul class="space-y-2">
                {% for weakness in result.mbti_type.weaknesses %}
                <li class="flex items-start gap-2 text-orange-700">
                    <span class="text-orange-600 mt-1">â€¢</span>
                    <span>{{ weakness }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- í•™ìŠµ íŒ -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h4 class="text-lg font-bold text-blue-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ’¡</span>
                í•™ìŠµ íŒ
            </h4>
            <ul class="space-y-2">
                {% for tip in result.mbti_type.tips %}
                <li class="flex items-start gap-2 text-blue-700">
                    <span class="text-blue-600 mt-1">â†’</span>
                    <span>{{ tip }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="flex gap-4">
        <a href="{{ url_for('student.reading_mbti') }}"
           class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium text-center py-3 rounded-lg transition">
            í…ŒìŠ¤íŠ¸ ëª©ë¡ìœ¼ë¡œ
        </a>
        <a href="{{ url_for('student.take_reading_mbti', test_id=result.test_id) }}"
           class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700
                  text-white font-medium text-center py-3 rounded-lg transition">
            ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸° ğŸ”„
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('radarChart').getContext('2d');

    const radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: [
                'ê¸°ë³¸ ë¬¸í•´ë ¥',
                'êµ¬ì¡°ì  ë…í•´',
                'ë¹„íŒì  ë…í•´',
                'ë‚´ìš© ì „ë‹¬',
                'ë…¼ë¦¬ì  í‘œí˜„',
                'ì°½ì˜ì  í™•ì¥',
                'ê°„ê²°í•œ ìš”ì•½',
                'ì²´ê³„ì  êµ¬ì„±',
                'ì°½ì˜ì  ì¬êµ¬ì„±'
            ],
            datasets: [{
                label: 'ë‚˜ì˜ ì ìˆ˜',
                data: [
                    {{ result.scores.read.beginner }},
                    {{ result.scores.read.intermediate }},
                    {{ result.scores.read.advanced }},
                    {{ result.scores.speech.beginner }},
                    {{ result.scores.speech.intermediate }},
                    {{ result.scores.speech.advanced }},
                    {{ result.scores.write.beginner }},
                    {{ result.scores.write.intermediate }},
                    {{ result.scores.write.advanced }}
                ],
                fill: true,
                backgroundColor: 'rgba(147, 51, 234, 0.2)',
                borderColor: 'rgb(147, 51, 234)',
                pointBackgroundColor: 'rgb(147, 51, 234)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(147, 51, 234)',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 25,
                    min: 0,
                    ticks: {
                        stepSize: 5,
                        font: {
                            size: 12
                        }
                    },
                    pointLabels: {
                        font: {
                            size: 13,
                            weight: 'bold'
                        },
                        color: '#374151'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    angleLines: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        label: function(context) {
                            return 'ì ìˆ˜: ' + context.parsed.r + 'ì  / 25ì ';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}
