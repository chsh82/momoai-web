{% extends "base.html" %}

{% block title %}ê³¼ì œ ì œì¶œ - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('student.index') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ëŒ€ì‹œë³´ë“œë¡œ
        </a>
        <h2 class="text-3xl font-bold text-gray-800">ìƒˆ ê³¼ì œ ì œì¶œ</h2>
        <p class="text-gray-600 mt-2">ì œì¶œí•˜ë©´ ë‹´ë‹¹ ê°•ì‚¬({{ student.teacher.name }})ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.</p>
    </div>

    <!-- ê³¼ì œ ì œì¶œ í¼ -->
    <div class="bg-white rounded-lg shadow">
        <div class="p-6">
            <form method="POST" action="{{ url_for('student.submit_essay') }}" enctype="multipart/form-data" onsubmit="return validateForm()">
                <div class="mb-6">
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                        ì œëª© <span class="text-red-500">*</span>
                    </label>
                    <input type="text"
                           id="title"
                           name="title"
                           required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="ì²¨ì‚­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <!-- íŒŒì¼ ì²¨ë¶€ -->
                <div class="mb-6">
                    <label for="attachments" class="block text-sm font-medium text-gray-700 mb-2">
                        ì²¨ë¶€ íŒŒì¼ (ì„ íƒì‚¬í•­, ìµœëŒ€ 10ê°œ)
                    </label>
                    <input type="file"
                           id="attachments"
                           name="attachments"
                           multiple
                           accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.hwp,.txt"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                           onchange="updateFileList(this)">
                    <div id="fileList" class="mt-3 space-y-2"></div>
                    <p class="mt-2 text-sm text-gray-500">
                        ğŸ’¡ ì´ë¯¸ì§€, PDF, ì›Œë“œ, í•œê¸€ íŒŒì¼ ë“±ì„ í•œ ë²ˆì— ìµœëŒ€ 10ê°œê¹Œì§€ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê° íŒŒì¼ ìµœëŒ€ 16MB)
                    </p>
                </div>

                <script>
                function updateFileList(input) {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '';

                    if (input.files.length > 10) {
                        alert('ìµœëŒ€ 10ê°œì˜ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        input.value = '';
                        return;
                    }

                    if (input.files.length > 0) {
                        const heading = document.createElement('p');
                        heading.className = 'text-sm font-medium text-gray-700';
                        heading.textContent = `ì„ íƒëœ íŒŒì¼ (${input.files.length}ê°œ):`;
                        fileList.appendChild(heading);

                        for (let i = 0; i < input.files.length; i++) {
                            const file = input.files[i];
                            const fileSize = (file.size / 1024 / 1024).toFixed(2);

                            if (file.size > 16 * 1024 * 1024) {
                                alert(`${file.name}ì˜ í¬ê¸°ê°€ 16MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                                input.value = '';
                                fileList.innerHTML = '';
                                return;
                            }

                            const fileItem = document.createElement('div');
                            fileItem.className = 'flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded';
                            fileItem.innerHTML = `
                                <span class="text-blue-600">ğŸ“</span>
                                <span class="flex-1">${file.name}</span>
                                <span class="text-gray-400">(${fileSize} MB)</span>
                            `;
                            fileList.appendChild(fileItem);
                        }
                    }
                }

                function validateForm() {
                    const title = document.getElementById('title').value.trim();
                    const content = document.getElementById('content').value.trim();
                    const attachments = document.getElementById('attachments').files;

                    // ì œëª©ì€ í•„ìˆ˜
                    if (!title) {
                        alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }

                    // ë³¸ë¬¸ ë˜ëŠ” ì²¨ë¶€íŒŒì¼ ì¤‘ í•˜ë‚˜ëŠ” ìˆì–´ì•¼ í•¨
                    if (!content && attachments.length === 0) {
                        alert('ë³¸ë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.');
                        return false;
                    }

                    return true;
                }
                </script>

                <div class="mb-6">
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                        ë³¸ë¬¸ <span class="text-gray-400 text-xs">(ì²¨ë¶€íŒŒì¼ì´ ìˆìœ¼ë©´ ì„ íƒì‚¬í•­)</span>
                    </label>
                    <textarea id="content"
                              name="content"
                              rows="20"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono"
                              placeholder="ì²¨ì‚­ë°›ì„ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    <p class="mt-2 text-sm text-gray-500">
                        ğŸ’¡ íŒ: ë³¸ë¬¸ ë‚´ìš©ì´ ì—†ì–´ë„ ì²¨ë¶€íŒŒì¼ë§Œìœ¼ë¡œ ê³¼ì œ ì œì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </p>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">ğŸ’¡</span>
                        <div>
                            <h4 class="font-medium text-blue-900 mb-1">ê³¼ì œ ì œì¶œ ì•ˆë‚´</h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li>â€¢ ì œì¶œí•˜ë©´ ë‹´ë‹¹ ê°•ì‚¬ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤</li>
                                <li>â€¢ ê°•ì‚¬ê°€ ì²¨ì‚­ì„ ì™„ë£Œí•˜ë©´ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                <li>â€¢ ì œì¶œ í›„ ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° ê°•ì‚¬ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button type="submit"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition duration-200">
                        ì œì¶œí•˜ê¸°
                    </button>
                    <a href="{{ url_for('student.index') }}"
                       class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 rounded-lg transition duration-200 text-center">
                        ì·¨ì†Œ
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
