{% extends "base.html" %}

{% block title %}{{ course.course_name }} - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('student.courses') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ìˆ˜ì—… ëª©ë¡ìœ¼ë¡œ
        </a>
        <div class="flex items-start justify-between">
            <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                    <h2 class="text-3xl font-bold text-gray-800">{{ course.course_name }}</h2>
                    {% if course.tier %}
                    <span class="px-3 py-1 text-sm font-medium rounded
                        {% if course.tier == 'A' %}bg-red-100 text-red-800
                        {% elif course.tier == 'B' %}bg-blue-100 text-blue-800
                        {% elif course.tier == 'C' %}bg-green-100 text-green-800
                        {% elif course.tier == 'VIP' %}bg-purple-100 text-purple-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ course.tier }}ë“±ê¸‰
                    </span>
                    {% endif %}
                </div>
                <p class="text-gray-600">ğŸ‘¨â€ğŸ« {{ course.teacher.name }} ê°•ì‚¬</p>
            </div>
            {% if course.teacher.zoom_token %}
            <div class="flex-shrink-0">
                <a href="{{ url_for('zoom.join', token=course.teacher.zoom_token) }}"
                   class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white px-6 py-3 rounded-lg transition duration-200 font-medium shadow-lg">
                    <span class="text-xl">ğŸ¥</span>
                    <span>ì˜¨ë¼ì¸ ê°•ì˜ì‹¤ ì…ì¥</span>
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ì¶œì„ í†µê³„ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì¶œì„ë¥ </p>
                    <p class="text-3xl font-bold text-green-600">{{ "%.1f"|format(enrollment.attendance_rate) }}%</p>
                </div>
                <div class="text-green-600 text-4xl">âœ…</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì¶œì„</p>
                    <p class="text-3xl font-bold text-blue-600">{{ enrollment.attended_sessions }}</p>
                </div>
                <div class="text-blue-600 text-4xl">âœ“</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì§€ê°</p>
                    <p class="text-3xl font-bold text-yellow-600">{{ enrollment.late_sessions }}</p>
                </div>
                <div class="text-yellow-600 text-4xl">â°</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ê²°ì„</p>
                    <p class="text-3xl font-bold text-red-600">{{ enrollment.absent_sessions }}</p>
                </div>
                <div class="text-red-600 text-4xl">âœ—</div>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì—… ì •ë³´ -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">ìˆ˜ì—… ì •ë³´</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% if course.schedule_type == 'weekly' and course.weekday is not none %}
                <div>
                    <p class="text-sm text-gray-600 mb-1">ìˆ˜ì—… ì‹œê°„</p>
                    <p class="text-gray-800 font-medium">
                        ë§¤ì£¼ {{ ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'][course.weekday] }}ìš”ì¼
                        {% if course.start_time %}{{ course.start_time.strftime('%H:%M') }}{% endif %}
                    </p>
                </div>
                {% endif %}

                {% if course.total_sessions %}
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì „ì²´ íšŒì°¨</p>
                    <p class="text-gray-800 font-medium">{{ course.total_sessions }}íšŒ</p>
                </div>
                {% endif %}

                <div>
                    <p class="text-sm text-gray-600 mb-1">ë“±ë¡ì¼</p>
                    <p class="text-gray-800 font-medium">{{ enrollment.enrolled_at.strftime('%Yë…„ %mì›” %dì¼') }}</p>
                </div>

                <div>
                    <p class="text-sm text-gray-600 mb-1">ë‹´ë‹¹ ê°•ì‚¬</p>
                    <p class="text-gray-800 font-medium">{{ course.teacher.name }}</p>
                </div>
            </div>

            {% if course.description %}
            <div class="mt-6 pt-6 border-t border-gray-200">
                <p class="text-sm text-gray-600 mb-2">ìˆ˜ì—… ì„¤ëª…</p>
                <p class="text-gray-800">{{ course.description }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ì¶œì„ ê¸°ë¡ -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">ì¶œì„ ê¸°ë¡</h3>
        </div>
        <div class="p-6">
            {% if attendances %}
            <div class="space-y-2">
                {% for attendance in attendances %}
                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">
                            {{ attendance.session.session_number }}íšŒì°¨
                        </p>
                        <p class="text-sm text-gray-600">
                            {{ attendance.session.session_date.strftime('%Yë…„ %mì›” %dì¼') }}
                        </p>
                    </div>
                    <span class="px-3 py-1 text-sm font-medium rounded
                        {% if attendance.status == 'present' %}bg-green-100 text-green-800
                        {% elif attendance.status == 'late' %}bg-yellow-100 text-yellow-800
                        {% elif attendance.status == 'absent' %}bg-red-100 text-red-800
                        {% elif attendance.status == 'excused' %}bg-blue-100 text-blue-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {% if attendance.status == 'present' %}ì¶œì„
                        {% elif attendance.status == 'late' %}ì§€ê°
                        {% elif attendance.status == 'absent' %}ê²°ì„
                        {% elif attendance.status == 'excused' %}ê²°ì„ (ì‚¬ìœ )
                        {% else %}ë¯¸ì²´í¬{% endif %}
                    </span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
