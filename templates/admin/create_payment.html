{% extends "base.html" %}

{% block title %}ê²°ì œ ìƒì„± - MOMOAI v4.0{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('admin.payments') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ê²°ì œ ëª©ë¡ìœ¼ë¡œ
        </a>
        <h2 class="text-3xl font-bold text-gray-800">ğŸ’³ ê²°ì œ ìƒì„±</h2>
        <p class="text-gray-600 mt-1">ì›”ë³„/ë¶„ê¸°ë³„ ê²°ì œë¥¼ ìƒì„±í•˜ê³  í• ì¸ì„ ì ìš©í•˜ì„¸ìš”</p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="mb-6 p-4 rounded-lg {% if category == 'error' %}bg-red-100 text-red-700 border border-red-300{% elif category == 'success' %}bg-green-100 text-green-700 border border-green-300{% elif category == 'warning' %}bg-yellow-100 text-yellow-700 border border-yellow-300{% else %}bg-blue-100 text-blue-700 border border-blue-300{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Form -->
    <div class="bg-white rounded-lg shadow-lg p-8">
        <form method="POST" action="{{ url_for('admin.create_payment') }}" id="paymentForm">
            {{ form.hidden_tag() }}

            <div class="space-y-6">
                <!-- í•™ìƒ ê²€ìƒ‰ -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h4 class="font-medium text-gray-800 mb-4">ğŸ‘¤ í•™ìƒ ì„ íƒ <span class="text-red-500">*</span></h4>

                    <!-- í•™ë…„ í•„í„° -->
                    <div class="mb-4">
                        {{ form.grade_filter.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.grade_filter(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", id="gradeFilter") }}
                        <p class="text-xs text-gray-500 mt-1">ì„ íƒ ì‹œ í•´ë‹¹ í•™ë…„ í•™ìƒë§Œ ê²€ìƒ‰ë©ë‹ˆë‹¤</p>
                    </div>

                    <!-- í•™ìƒ ê²€ìƒ‰ ì…ë ¥ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">í•™ìƒ ì´ë¦„ ê²€ìƒ‰</label>
                        <div class="relative">
                            <input type="text"
                                   id="studentSearch"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                   autocomplete="off">
                            <div id="searchResults" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
                        </div>
                    </div>

                    <!-- ì„ íƒëœ í•™ìƒ í‘œì‹œ -->
                    <div id="selectedStudent" class="hidden">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ì„ íƒëœ í•™ìƒ</p>
                                    <p class="font-medium text-gray-800" id="selectedStudentName">-</p>
                                    <p class="text-xs text-gray-600" id="selectedStudentInfo">-</p>
                                </div>
                                <button type="button" onclick="clearStudentSelection()" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                    ë³€ê²½
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden field for student_id -->
                    {{ form.student_id() }}
                    {% if form.student_id.errors %}
                        {% for error in form.student_id.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- ìˆ˜ì—… ì„ íƒ -->
                <div>
                    {{ form.course_id.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <span class="text-red-500">*</span>
                    {{ form.course_id(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", id="courseSelect") }}
                    {% if form.course_id.errors %}
                        {% for error in form.course_id.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">âœ¨ í•™ìƒ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ì„ íƒë©ë‹ˆë‹¤</p>
                </div>

                <!-- ê²°ì œ ì£¼ê¸° -->
                <div>
                    {{ form.payment_period.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <span class="text-red-500">*</span>
                    {{ form.payment_period(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", onchange="calculateAmount()") }}
                    {% if form.payment_period.errors %}
                        {% for error in form.payment_period.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">ê¸°ë³¸ê°’: ì›”ë³„ ê²°ì œ</p>
                </div>

                <!-- ì´ì›”ê²°ì„ -->
                <div>
                    {{ form.carryover_option.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.carryover_option(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", onchange="toggleCustomCarryover()") }}
                    <p class="text-xs text-gray-500 mt-1">ì§€ë‚œ ë‹¬ì— ê²°ì„í•œ ìˆ˜ì—… íšŸìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš” (ì´ì›”ê²°ì„ì€ ê²°ì œ íšŒì°¨ì—ì„œ ì°¨ê°ë©ë‹ˆë‹¤)</p>
                </div>

                <!-- ì´ì›”ê²°ì„ ì§ì ‘ ì…ë ¥ -->
                <div id="customCarryoverDiv" style="display: none;">
                    {{ form.carryover_absences.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.carryover_absences(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", oninput="calculateAmount()", id="customCarryoverInput") }}
                    {% if form.carryover_absences.errors %}
                        {% for error in form.carryover_absences.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-1">0-12íšŒ ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ìˆ˜ì—…ë£Œ ì„ íƒ -->
                    <div>
                        {{ form.price_option.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.price_option(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", onchange="toggleCustomPrice()") }}
                    </div>

                    <!-- íšŒë‹¹ ìˆ˜ì—…ë£Œ (ì§ì ‘ ì…ë ¥) -->
                    <div id="customPriceDiv" style="display: none;">
                        {{ form.price_per_session.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.price_per_session(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", oninput="calculateAmount()", id="customPriceInput") }}
                        {% if form.price_per_session.errors %}
                            {% for error in form.price_per_session.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <!-- í• ì¸ ìœ í˜• -->
                <div>
                    {{ form.discount_type.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.discount_type(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500", onchange="calculateAmount()") }}
                    <p class="text-xs text-gray-500 mt-1">
                        â€¢ ì§€ì¸ í• ì¸: 20% | í˜•ì œ í• ì¸: 10% | ë¶„ê¸°ë³„ ê²°ì œ í• ì¸: 5%
                    </p>
                </div>

                <!-- ê²°ì œ ê¸ˆì•¡ ê³„ì‚° ê²°ê³¼ -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h4 class="font-medium text-blue-900 mb-4">ğŸ’° ê²°ì œ ê¸ˆì•¡ ê³„ì‚°</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800">ê²°ì œ ì£¼ê¸°</span>
                            <span id="periodText" class="font-medium text-blue-900">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800">íšŒë‹¹ ìˆ˜ì—…ë£Œ</span>
                            <span id="pricePerSession" class="font-medium text-blue-900">0ì›</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800">ê¸°ë³¸ íšŒì°¨</span>
                            <span id="baseSessionCount" class="font-medium text-blue-900">0íšŒ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800 text-sm">- ì´ì›”ê²°ì„ ì°¨ê°</span>
                            <span id="carryoverText" class="font-medium text-orange-600">0íšŒ</span>
                        </div>
                        <div class="flex justify-between items-center border-t border-blue-300 pt-2">
                            <span class="text-blue-800 font-medium">ì‹¤ì œ ê²°ì œ íšŒì°¨</span>
                            <span id="sessionCount" class="font-bold text-blue-900">0íšŒ</span>
                        </div>
                        <div class="flex justify-between items-center border-t border-blue-300 pt-3 mt-3">
                            <span class="text-blue-800">ì›ê¸ˆì•¡</span>
                            <span id="originalAmount" class="font-medium text-blue-900">0ì›</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-800">í• ì¸</span>
                            <span id="discountInfo" class="font-medium text-red-600">0ì› (0%)</span>
                        </div>
                        <div class="flex justify-between items-center border-t-2 border-blue-400 pt-3">
                            <span class="text-lg font-bold text-blue-900">ìµœì¢… ê²°ì œ ê¸ˆì•¡</span>
                            <span id="finalAmount" class="text-2xl font-bold text-blue-900">0ì›</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ê²°ì œ ë°©ë²• -->
                    <div>
                        {{ form.payment_method.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.payment_method(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>

                    <!-- ë‚©ë¶€ ê¸°í•œ -->
                    <div>
                        {{ form.due_date.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                        {{ form.due_date(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                </div>

                <!-- ë©”ëª¨ -->
                <div>
                    {{ form.notes.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    {{ form.notes(class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                </div>

                <!-- ì•ˆë‚´ ì‚¬í•­ -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="text-yellow-600 text-xl mr-3">â„¹ï¸</div>
                        <div class="text-sm text-yellow-800">
                            <p class="font-medium mb-1">ê²°ì œ ìƒì„± ì•ˆë‚´</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>í•™ìƒ ì„ íƒ ì‹œ</strong> ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ìë™ìœ¼ë¡œ ì„ íƒë©ë‹ˆë‹¤</li>
                                <li><strong>ê¸°ë³¸ ì„¤ì •:</strong> ì›”ë³„ ê²°ì œ(4íšŒ), 65,000ì›/íšŒ, í• ì¸ ì—†ìŒ, ì´ì›”ê²°ì„ 0íšŒ</li>
                                <li><strong>ì´ì›”ê²°ì„:</strong> ì§€ë‚œ ë‹¬ ê²°ì„í•œ ìˆ˜ì—… íšŸìˆ˜ë¥¼ ì„ íƒí•˜ë©´ ê²°ì œ íšŒì°¨ì—ì„œ ìë™ìœ¼ë¡œ ì°¨ê°ë©ë‹ˆë‹¤<br>
                                    <span class="text-xs">(ì˜ˆ: ì›”ë³„ 4íšŒ - ì´ì›”ê²°ì„ 1íšŒ = ì‹¤ì œ ê²°ì œ 3íšŒ)</span></li>
                                <li><strong>ë‚©ë¶€ ê¸°í•œ:</strong> ìë™ìœ¼ë¡œ í•´ë‹¹ ì›” ë§ì¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤</li>
                                <li>ì›”ë³„ ê²°ì œëŠ” 4íšŒ, ë¶„ê¸°ë³„ ê²°ì œëŠ” 12íšŒ ê¸°ì¤€ì…ë‹ˆë‹¤</li>
                                <li>ìƒì„±ëœ ê²°ì œëŠ” 'ëŒ€ê¸°' ìƒíƒœë¡œ ì‹œì‘ë©ë‹ˆë‹¤</li>
                                <li>ë‚˜ì¤‘ì— ê²°ì œ API ì—°ë™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ë²„íŠ¼ -->
                <div class="flex gap-3 pt-4">
                    {{ form.submit(class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition duration-200") }}
                    <a href="{{ url_for('admin.payments') }}"
                       class="flex-1 text-center bg-gray-400 hover:bg-gray-500 text-white font-medium py-3 rounded-lg transition duration-200">
                        ì·¨ì†Œ
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
let searchTimeout = null;
let selectedStudentId = null;

// í•™ìƒ ê²€ìƒ‰
document.getElementById('studentSearch').addEventListener('input', function(e) {
    const query = e.target.value.trim();
    const grade = document.getElementById('gradeFilter').value;

    clearTimeout(searchTimeout);

    if (query.length < 1) {
        document.getElementById('searchResults').classList.add('hidden');
        return;
    }

    searchTimeout = setTimeout(() => {
        fetch(`/admin/api/students/search?q=${encodeURIComponent(query)}&grade=${encodeURIComponent(grade)}`)
            .then(response => response.json())
            .then(students => {
                displaySearchResults(students);
            })
            .catch(error => {
                console.error('Search error:', error);
            });
    }, 300);
});

// ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
function displaySearchResults(students) {
    const resultsDiv = document.getElementById('searchResults');

    if (students.length === 0) {
        resultsDiv.innerHTML = '<div class="p-4 text-gray-500 text-sm">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        resultsDiv.classList.remove('hidden');
        return;
    }

    let html = '';
    students.forEach(student => {
        html += `
            <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                 onclick="selectStudent('${student.student_id}', '${student.name}', '${student.grade}', '${student.school}', ${student.course_count})">
                <div class="font-medium text-gray-800">${student.name}</div>
                <div class="text-xs text-gray-600">
                    ${student.grade ? student.grade : ''}
                    ${student.school ? '| ' + student.school : ''}
                    | ìˆ˜ê°• ${student.course_count}ê°œ
                </div>
            </div>
        `;
    });

    resultsDiv.innerHTML = html;
    resultsDiv.classList.remove('hidden');
}

// í•™ìƒ ì„ íƒ
function selectStudent(studentId, name, grade, school, courseCount) {
    selectedStudentId = studentId;

    // Hidden fieldì— í•™ìƒ ID ì„¤ì •
    document.querySelector('input[name="student_id"]').value = studentId;

    // ì„ íƒëœ í•™ìƒ ì •ë³´ í‘œì‹œ
    document.getElementById('selectedStudentName').textContent = name;
    document.getElementById('selectedStudentInfo').textContent =
        `${grade ? grade : ''} ${school ? '| ' + school : ''} | ìˆ˜ê°• ${courseCount}ê°œ`;
    document.getElementById('selectedStudent').classList.remove('hidden');

    // ê²€ìƒ‰ ê²°ê³¼ ìˆ¨ê¸°ê¸°
    document.getElementById('searchResults').classList.add('hidden');
    document.getElementById('studentSearch').value = '';

    // ìˆ˜ì—… ìë™ ì„ íƒ
    autoSelectCourse(studentId);
}

// í•™ìƒ ì„ íƒ í•´ì œ
function clearStudentSelection() {
    selectedStudentId = null;
    document.querySelector('input[name="student_id"]').value = '';
    document.getElementById('selectedStudent').classList.add('hidden');
    document.getElementById('studentSearch').value = '';
    document.getElementById('courseSelect').value = '';
}

// í•™ìƒ ì„ íƒ ì‹œ ìˆ˜ì—… ìë™ ì„ íƒ
function autoSelectCourse(studentId) {
    if (!studentId) return;

    fetch(`/admin/api/students/${studentId}/courses`)
        .then(response => response.json())
        .then(data => {
            const courseSelect = document.getElementById('courseSelect');
            if (data.courses && data.courses.length > 0) {
                courseSelect.value = data.courses[0];
            } else {
                courseSelect.value = '';
            }
        })
        .catch(error => {
            console.error('Error loading courses:', error);
        });
}

// ê²€ìƒ‰ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
document.addEventListener('click', function(e) {
    if (!e.target.closest('#studentSearch') && !e.target.closest('#searchResults')) {
        document.getElementById('searchResults').classList.add('hidden');
    }
});

// ìˆ˜ì—…ë£Œ ì§ì ‘ ì…ë ¥ í† ê¸€
function toggleCustomPrice() {
    const priceOption = document.querySelector('select[name="price_option"]').value;
    const customPriceDiv = document.getElementById('customPriceDiv');
    const customPriceInput = document.getElementById('customPriceInput');

    if (priceOption === 'custom') {
        customPriceDiv.style.display = 'block';
        customPriceInput.required = true;
    } else {
        customPriceDiv.style.display = 'none';
        customPriceInput.required = false;
    }

    calculateAmount();
}

// ì´ì›”ê²°ì„ ì§ì ‘ ì…ë ¥ í† ê¸€
function toggleCustomCarryover() {
    const carryoverOption = document.querySelector('select[name="carryover_option"]').value;
    const customCarryoverDiv = document.getElementById('customCarryoverDiv');
    const customCarryoverInput = document.getElementById('customCarryoverInput');

    if (carryoverOption === 'custom') {
        customCarryoverDiv.style.display = 'block';
        customCarryoverInput.required = true;
    } else {
        customCarryoverDiv.style.display = 'none';
        customCarryoverInput.required = false;
    }

    calculateAmount();
}

function calculateAmount() {
    // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
    const period = document.querySelector('select[name="payment_period"]').value;
    const priceOption = document.querySelector('select[name="price_option"]').value;
    const customPrice = parseInt(document.querySelector('input[name="price_per_session"]').value) || 0;
    const carryoverOption = document.querySelector('select[name="carryover_option"]').value;
    const customCarryover = parseInt(document.querySelector('input[name="carryover_absences"]').value) || 0;
    const discountType = document.querySelector('select[name="discount_type"]').value;

    // ìˆ˜ì—…ë£Œ ê²°ì •
    let pricePerSession = 0;
    if (priceOption === 'custom') {
        pricePerSession = customPrice;
    } else if (priceOption) {
        pricePerSession = parseInt(priceOption);
    }

    // ê¸°ë³¸ íšŒì°¨ ìˆ˜ ê³„ì‚°
    const baseSessionCount = period === 'monthly' ? 4 : (period === 'quarterly' ? 12 : 0);

    // ì´ì›”ê²°ì„ ì²˜ë¦¬
    let carryover = 0;
    if (carryoverOption === 'custom') {
        carryover = customCarryover;
    } else if (carryoverOption) {
        carryover = parseInt(carryoverOption);
    }

    // ì‹¤ì œ ê²°ì œ íšŒì°¨ (ì´ì›”ê²°ì„ ì°¨ê°)
    const sessionCount = Math.max(0, baseSessionCount - carryover);

    // ì›ê¸ˆì•¡ ê³„ì‚°
    const originalAmount = pricePerSession * sessionCount;

    // í• ì¸ìœ¨ ê³„ì‚°
    let discountRate = 0;
    if (discountType === 'acquaintance') discountRate = 0.20;
    else if (discountType === 'sibling') discountRate = 0.10;
    else if (discountType === 'quarterly') discountRate = 0.05;

    // í• ì¸ ê¸ˆì•¡ ê³„ì‚°
    const discountAmount = Math.floor(originalAmount * discountRate);

    // ìµœì¢… ê¸ˆì•¡ ê³„ì‚°
    const finalAmount = originalAmount - discountAmount;

    // í™”ë©´ì— í‘œì‹œ
    document.getElementById('periodText').textContent =
        period === 'monthly' ? 'ì›”ë³„ ê²°ì œ' : (period === 'quarterly' ? 'ë¶„ê¸°ë³„ ê²°ì œ' : '-');
    document.getElementById('pricePerSession').textContent = pricePerSession.toLocaleString() + 'ì›';
    document.getElementById('baseSessionCount').textContent = baseSessionCount + 'íšŒ';
    document.getElementById('carryoverText').textContent = carryover + 'íšŒ';
    document.getElementById('sessionCount').textContent = sessionCount + 'íšŒ';
    document.getElementById('originalAmount').textContent = originalAmount.toLocaleString() + 'ì›';
    document.getElementById('discountInfo').textContent =
        discountAmount.toLocaleString() + 'ì› (' + (discountRate * 100) + '%)';
    document.getElementById('finalAmount').textContent = finalAmount.toLocaleString() + 'ì›';
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¤ì •
window.addEventListener('DOMContentLoaded', function() {
    toggleCustomPrice();
    toggleCustomCarryover();
    calculateAmount();
});
</script>
{% endblock %}
