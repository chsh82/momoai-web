{% extends "base.html" %}

{% block title %}{{ student.name }} í•™ìƒ í”„ë¡œí•„ - MOMOAI v4.0{% endblock %}

{% block page_title %}ğŸ‘¤ {{ student.name }} í•™ìƒ í”„ë¡œí•„{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">{{ student.grade }} Â· {{ student.student_id[:8] }}</span>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('admin.student_profiles') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† í•™ìƒ ëª©ë¡ìœ¼ë¡œ
        </a>
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <h2 class="text-3xl font-bold text-gray-800">{{ student.name }} í•™ìƒ í”„ë¡œí•„</h2>
                <span class="px-3 py-1 {% if student.tier == 'VIP' %}bg-yellow-100 text-yellow-800{% elif student.tier == 'A' %}bg-green-100 text-green-800{% elif student.tier == 'B' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-800{% endif %} text-sm font-medium rounded-full">
                    {{ student.tier }}
                </span>
            </div>
            <div class="flex gap-2">
                {% if profile %}
                <a href="{{ url_for('admin.edit_student_profile', student_id=student.student_id) }}"
                   class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                    âœï¸ í”„ë¡œí•„ ìˆ˜ì •
                </a>
                {% else %}
                <a href="{{ url_for('admin.create_student_profile', student_id=student.student_id) }}"
                   class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                    â• í”„ë¡œí•„ ìƒì„±
                </a>
                {% endif %}
            </div>
        </div>
        <p class="text-gray-600 mt-1">{{ student.grade }} | {{ student.student_id[:8] }}</p>
    </div>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px">
                <button onclick="showTab('basic')" id="tab-basic"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-blue-500 text-blue-600">
                    ğŸ“‹ ê¸°ë³¸ì •ë³´
                </button>
                <button onclick="showTab('profile')" id="tab-profile"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ“ í”„ë¡œí•„
                </button>
                <button onclick="showTab('mbti')" id="tab-mbti"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ§  MBTI
                </button>
                <button onclick="showTab('consultation')" id="tab-consultation"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ’¬ ìƒë‹´ì´ë ¥
                </button>
                <button onclick="showTab('insights')" id="tab-insights"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ¤– AI ì¸ì‚¬ì´íŠ¸
                </button>
            </nav>
        </div>
    </div>

    <!-- íƒ­ ì½˜í…ì¸  -->
    <div id="tab-content">
        <!-- ê¸°ë³¸ì •ë³´ íƒ­ -->
        <div id="content-basic" class="tab-content">
            <!-- í•™ìƒ ì •ë³´ ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">í•™ìƒ ì •ë³´</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div class="text-sm text-gray-600 mb-1">í•™ìƒ ID</div>
                            <div class="font-medium">{{ student.student_id[:16] }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">í•™ë…„</div>
                            <div class="font-medium">{{ student.grade }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ì´ë©”ì¼</div>
                            <div class="font-medium">{{ student.email or '-' }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ì „í™”ë²ˆí˜¸</div>
                            <div class="font-medium">{{ student.phone or '-' }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ìƒë…„ì›”ì¼</div>
                            <div class="font-medium">{{ student.birth_date.strftime('%Y-%m-%d') if student.birth_date else '-' }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ì¬í•™ í•™êµ</div>
                            <div class="font-medium">{{ student.school or '-' }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•™ë¶€ëª¨ ì •ë³´ -->
            {% if parents %}
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">í•™ë¶€ëª¨ ì •ë³´</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for parent in parents %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <div class="font-medium">{{ parent.name }}</div>
                                <div class="text-sm text-gray-600">{{ parent.email }}</div>
                                {% if parent.phone %}
                                <div class="text-sm text-gray-600">ğŸ“ {{ parent.phone }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ìˆ˜ê°• ë‚´ì—­ -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800">ìˆ˜ê°• ë‚´ì—­</h3>
                    <span class="text-sm text-gray-600">ì´ {{ enrollments|length }}ê°œ ìˆ˜ì—…</span>
                </div>
                <div class="p-6">
                    {% if enrollments %}
                    <div class="space-y-4">
                        {% for enrollment in enrollments %}
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <div class="font-medium text-lg">{{ enrollment.course.name }}</div>
                                    <div class="text-sm text-gray-600">{{ enrollment.course.course_type }} | {{ enrollment.course.grade }}</div>
                                    <div class="text-sm text-gray-500">ê°•ì‚¬: {{ enrollment.course.teacher.name }}</div>
                                </div>
                                <span class="px-3 py-1 {% if enrollment.status == 'active' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %} text-sm font-medium rounded-full">
                                    {% if enrollment.status == 'active' %}ìˆ˜ê°•ì¤‘{% else %}ì¢…ë£Œ{% endif %}
                                </span>
                            </div>

                            <!-- ì¶œì„ í†µê³„ -->
                            <div class="grid grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600">{{ enrollment.attended_sessions }}</div>
                                    <div class="text-xs text-gray-600">ì¶œì„</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-600">{{ enrollment.late_sessions }}</div>
                                    <div class="text-xs text-gray-600">ì§€ê°</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600">{{ enrollment.absent_sessions }}</div>
                                    <div class="text-xs text-gray-600">ê²°ì„</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600">
                                        {% set total = enrollment.attended_sessions + enrollment.late_sessions + enrollment.absent_sessions %}
                                        {% if total > 0 %}
                                            {{ ((enrollment.attended_sessions / total) * 100)|round(1) }}%
                                        {% else %}
                                            0%
                                        {% endif %}
                                    </div>
                                    <div class="text-xs text-gray-600">ì¶œì„ë¥ </div>
                                </div>
                            </div>

                            <div class="mt-4">
                                <a href="{{ url_for('admin.course_detail', course_id=enrollment.course_id) }}"
                                   class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    ìˆ˜ì—… ìƒì„¸ ë³´ê¸° â†’
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“š</div>
                        <p>ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- í”¼ë“œë°± ì´ë ¥ -->
            {% if feedbacks %}
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">ê°•ì‚¬ í”¼ë“œë°± ì´ë ¥</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for feedback in feedbacks %}
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-sm text-gray-600">
                                    {{ feedback.created_at.strftime('%Yë…„ %mì›” %dì¼') }} | ê°•ì‚¬: {{ feedback.teacher.name }}
                                </div>
                                <span class="px-2 py-1 {% if feedback.feedback_type == 'positive' %}bg-green-100 text-green-800{% elif feedback.feedback_type == 'improvement' %}bg-orange-100 text-orange-800{% else %}bg-blue-100 text-blue-800{% endif %} text-xs rounded-full">
                                    {% if feedback.feedback_type == 'positive' %}ì¹­ì°¬{% elif feedback.feedback_type == 'improvement' %}ê°œì„ {% else %}ì¼ë°˜{% endif %}
                                </span>
                            </div>
                            <div class="text-gray-700 mb-2">{{ feedback.content }}</div>
                            {% if feedback.hidden_from_student %}
                            <div class="text-xs text-gray-500 flex items-center gap-1">
                                <span>ğŸ”’</span>
                                <span>í•™ìƒì—ê²Œ ë¹„ê³µê°œ</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- í”„ë¡œí•„ íƒ­ -->
        <div id="content-profile" class="tab-content hidden">
            {% if profile %}
            <!-- ì£¼ìš” íŠ¹ì§• ì¹´ë“œ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- ë…ì„œ ì—­ëŸ‰ -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-5 border border-blue-200">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-semibold text-blue-900">ğŸ“š ë…ì„œ ì—­ëŸ‰</h3>
                    </div>
                    <div class="text-3xl font-bold text-blue-700 mb-1">
                        {% if profile.reading_competency %}
                        {{ profile.reading_competency }}/5
                        {% else %}
                        -
                        {% endif %}
                    </div>
                    <div class="text-xs text-blue-600">
                        {% if profile.weekly_reading_amount %}
                        {{ profile.weekly_reading_amount }}
                        {% endif %}
                    </div>
                </div>

                <!-- ìˆ˜ì—… ê²½í—˜ -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-5 border border-green-200">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-semibold text-green-900">âœï¸ ìˆ˜ì—… ê²½í—˜</h3>
                    </div>
                    <div class="text-lg font-bold text-green-700 mb-1">
                        {% if profile.reading_experience %}
                        {{ profile.reading_experience }}
                        {% else %}
                        ì—†ìŒ
                        {% endif %}
                    </div>
                    <div class="text-xs text-green-600">ë…ì„œë…¼ìˆ  ìˆ˜ì—…</div>
                </div>

                <!-- ì§„í•™ ëª©í‘œ -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-5 border border-purple-200">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-semibold text-purple-900">ğŸ¯ ì§„í•™ ëª©í‘œ</h3>
                    </div>
                    <div class="text-sm font-medium text-purple-700 line-clamp-2">
                        {% if profile.academic_goals_list %}
                        {{ profile.academic_goals_list[0] }}
                        {% if profile.academic_goals_list|length > 1 %}
                        <span class="text-xs">ì™¸ {{ profile.academic_goals_list|length - 1 }}ê°œ</span>
                        {% endif %}
                        {% else %}
                        ë¯¸ì •
                        {% endif %}
                    </div>
                </div>

                <!-- ì„±í–¥ -->
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-5 border border-orange-200">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-semibold text-orange-900">ğŸ‘¤ í•™ìƒ ì„±í–¥</h3>
                    </div>
                    <div class="text-sm font-medium text-orange-700 line-clamp-2">
                        {% if profile.personality_traits_list %}
                        {{ profile.personality_traits_list[0] }}
                        {% if profile.personality_traits_list|length > 1 %}
                        <span class="text-xs">ì™¸ {{ profile.personality_traits_list|length - 1 }}ê°œ</span>
                        {% endif %}
                        {% else %}
                        -
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ ì„¹ì…˜ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ê¸°ë³¸ ì •ë³´</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-1">ì¬í•™ í•™êµ</p>
                            <p class="font-medium text-gray-800">{{ profile.current_school or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">í•™ë¶€ëª¨ ì—°ë½ì²˜</p>
                            <p class="font-medium text-gray-800">{{ profile.parent_contact or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">ì£¼ì†Œ</p>
                            <p class="font-medium text-gray-800">{{ profile.address or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">ìœ ì… ê²½ë¡œ</p>
                            <p class="font-medium text-gray-800">{{ profile.referral_source or '-' }}</p>
                        </div>
                        {% if profile.sibling_info %}
                        <div>
                            <p class="text-gray-600 mb-1">í˜•ì œìë§¤</p>
                            <p class="font-medium text-gray-800">{{ profile.sibling_info }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ë…ì„œ ì„±í–¥ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ë…ì„œ ì„±í–¥</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-2">ì„ í˜¸ ë…ì„œ ë¶„ì•¼</p>
                            <div class="flex flex-wrap gap-2">
                                {% for genre in profile.preferred_genres_list %}
                                <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ genre }}</span>
                                {% else %}
                                <p class="text-gray-500">-</p>
                                {% endfor %}
                            </div>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-2">í•™ìƒ ì„±í–¥</p>
                            <div class="flex flex-wrap gap-2">
                                {% for trait in profile.personality_traits_list %}
                                <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ trait }}</span>
                                {% else %}
                                <p class="text-gray-500">-</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìˆ˜ì—… ëª©í‘œ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ìˆ˜ì—… ëª©í‘œ</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-1">ì£¼ìš” í–¥ìƒ ëª©í‘œ</p>
                            <p class="font-medium text-gray-800">{{ profile.main_improvement_goal or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">ì„ í˜¸ ìˆ˜ì—… ìŠ¤íƒ€ì¼</p>
                            <p class="font-medium text-gray-800">{{ profile.preferred_class_style or '-' }}</p>
                        </div>
                        {% if profile.teacher_request %}
                        <div>
                            <p class="text-gray-600 mb-1">ê°•ì‚¬ ìš”ì²­ì‚¬í•­</p>
                            <p class="font-medium text-gray-800 bg-yellow-50 p-2 rounded border border-yellow-200">{{ profile.teacher_request }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ì§„ë¡œ/ì§„í•™ ì •ë³´ -->
            {% if profile.academic_goals_list or profile.career_interests_list or profile.education_info_needs_list %}
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800">ì§„ë¡œ ë° ì§„í•™ ì •ë³´</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                    <div>
                        <p class="text-gray-600 mb-2 font-medium">ì§„í•™ ëª©í‘œ</p>
                        <div class="space-y-1">
                            {% for goal in profile.academic_goals_list %}
                            <p class="text-gray-800">â€¢ {{ goal }}</p>
                            {% else %}
                            <p class="text-gray-500">-</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 mb-2 font-medium">ì§„ë¡œ ê´€ì‹¬ ë¶„ì•¼</p>
                        <div class="space-y-1">
                            {% for interest in profile.career_interests_list %}
                            <p class="text-gray-800">â€¢ {{ interest }}</p>
                            {% else %}
                            <p class="text-gray-500">-</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600 mb-2 font-medium">í•„ìš”í•œ êµìœ¡ ì •ë³´</p>
                        <div class="space-y-1">
                            {% for need in profile.education_info_needs_list %}
                            <p class="text-gray-800">â€¢ {{ need }}</p>
                            {% else %}
                            <p class="text-gray-500">-</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% if profile.other_interests %}
                <div class="px-6 pb-6">
                    <p class="text-gray-600 mb-1 font-medium text-sm">ê¸°íƒ€ ê´€ì‹¬ì‚¬í•­</p>
                    <p class="text-gray-800 text-sm bg-gray-50 p-3 rounded">{{ profile.other_interests }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% else %}
            <!-- í”„ë¡œí•„ ì—†ìŒ -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ“‹</div>
                <p class="text-gray-700 font-medium mb-4">ì•„ì§ ê¸°ì´ˆ ì¡°ì‚¬ í”„ë¡œí•„ì´ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                <a href="{{ url_for('admin.create_student_profile', student_id=student.student_id) }}"
                   class="inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition duration-200">
                    â• í”„ë¡œí•„ ìƒì„±í•˜ê¸°
                </a>
            </div>
            {% endif %}
        </div>

        <!-- MBTI íƒ­ -->
        <div id="content-mbti" class="tab-content hidden">
            {% if mbti_result and mbti_type %}
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg shadow-lg p-6 mb-6 border-2 border-purple-200 cursor-pointer hover:border-purple-300 transition"
                 onclick="window.location.href='{{ url_for('admin.mbti_result_detail', result_id=mbti_result.result_id) }}'">
                <div class="flex items-center justify-between mb-6">
                    <div class="text-center flex-1">
                        <h3 class="text-2xl font-bold text-purple-900 mb-2">{{ mbti_type.type_name }}</h3>
                        <p class="text-purple-700">{{ mbti_result.type_combination }}</p>
                        <p class="text-sm text-gray-600 mt-2">í…ŒìŠ¤íŠ¸ ì¼ì‹œ: {{ mbti_result.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                    <span class="text-gray-500 text-2xl">â†’</span>
                </div>

                <div class="bg-white bg-opacity-60 rounded-lg p-4 mb-4">
                    <p class="text-sm text-purple-600 font-medium mb-2">íŠ¹ì§•</p>
                    <p class="text-gray-800">{{ (mbti_type.full_description[:100] + '...') if mbti_type.full_description and mbti_type.full_description|length > 100 else (mbti_type.full_description or '-') }}</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-blue-600 font-bold mb-2">ğŸ“– ì½ê¸°</p>
                        <p class="text-lg font-bold text-blue-900">{{ mbti_result.read_type }}</p>
                    </div>
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-green-600 font-bold mb-2">ğŸ’¬ ë§í•˜ê¸°</p>
                        <p class="text-lg font-bold text-green-900">{{ mbti_result.speech_type }}</p>
                    </div>
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-orange-600 font-bold mb-2">âœï¸ ì“°ê¸°</p>
                        <p class="text-lg font-bold text-orange-900">{{ mbti_result.write_type }}</p>
                    </div>
                </div>

                <p class="text-center text-sm text-purple-700 mt-4">í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ ë³´ê¸°</p>
            </div>
            {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ§ </div>
                <p class="text-gray-700 font-medium">ì•„ì§ MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>

        <!-- ìƒë‹´ì´ë ¥ íƒ­ -->
        <div id="content-consultation" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ’¬ ìƒë‹´ ì´ë ¥</h3>
                    <div class="flex items-center gap-3">
                        <span class="text-sm text-gray-600">ìµœê·¼ 10ê±´</span>
                        <a href="{{ url_for('admin.consultations', student_id=student.student_id) }}"
                           class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            ì „ì²´ ë³´ê¸° â†’
                        </a>
                    </div>
                </div>
                <div class="p-6">
                    {% if consultations %}
                    <div class="space-y-3">
                        {% for consultation in consultations %}
                        <a href="{{ url_for('admin.consultation_detail', consultation_id=consultation.consultation_id) }}"
                           class="block border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50 transition duration-200">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-1 rounded">
                                        {{ consultation.major_category }}
                                    </span>
                                    {% if consultation.sub_category %}
                                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">
                                        {{ consultation.sub_category }}
                                    </span>
                                    {% endif %}
                                </div>
                                <span class="text-xs text-gray-500">{{ consultation.consultation_date.strftime('%Y-%m-%d') }}</span>
                            </div>
                            <p class="text-sm font-medium text-gray-800 mb-1">{{ consultation.title }}</p>
                            <p class="text-xs text-gray-600 line-clamp-1">{{ consultation.content }}</p>
                            <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                                <span>ğŸ‘¤ {{ consultation.counselor.name }}</span>
                                <span class="text-gray-400">â€¢</span>
                                <span class="text-blue-600">ìƒì„¸ë³´ê¸° â†’</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-4xl mb-3">ğŸ“­</div>
                        <p>ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- AI ì¸ì‚¬ì´íŠ¸ íƒ­ -->
        <div id="content-insights" class="tab-content hidden">
            {% if insights %}
            <!-- ì „ì²´ ìƒíƒœ ì¹´ë“œ -->
            <div class="mb-6 bg-gradient-to-r {% if insights.overall_color == 'red' %}from-red-50 to-red-100 border-red-300{% elif insights.overall_color == 'yellow' %}from-yellow-50 to-yellow-100 border-yellow-300{% else %}from-green-50 to-green-100 border-green-300{% endif %} border-2 rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold {% if insights.overall_color == 'red' %}text-red-900{% elif insights.overall_color == 'yellow' %}text-yellow-900{% else %}text-green-900{% endif %}">
                            {{ insights.overall_label }}
                        </h3>
                        <p class="text-sm text-gray-700 mt-1">ìœ„í—˜ë„ ì ìˆ˜: {{ insights.risk_score }}ì </p>
                    </div>
                    <div class="text-5xl">
                        {% if insights.overall_color == 'red' %}ğŸ”´
                        {% elif insights.overall_color == 'yellow' %}ğŸŸ¡
                        {% else %}ğŸŸ¢
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- 4ê°œ ì˜ì—­ ê·¸ë¦¬ë“œ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- ìœ„í—˜ ìš”ì†Œ -->
                <div class="bg-white rounded-lg shadow border-l-4 border-red-500">
                    <div class="px-6 py-4 border-b border-gray-200 bg-red-50">
                        <h3 class="text-lg font-bold text-red-900">ğŸ”´ ìœ„í—˜ ìš”ì†Œ ({{ insights.risk_factors|length }})</h3>
                        <p class="text-xs text-red-700 mt-1">ì¦‰ì‹œ ì¡°ì¹˜ê°€ í•„ìš”í•œ ë¬¸ì œ</p>
                    </div>
                    <div class="p-6">
                        {% if insights.risk_factors %}
                        <div class="space-y-3">
                            {% for factor in insights.risk_factors %}
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">{{ factor.icon }}</span>
                                    <div class="flex-1">
                                        <p class="font-semibold text-red-900 mb-1">{{ factor.category }}</p>
                                        <p class="text-sm text-gray-700">{{ factor.description }}</p>
                                        {% if factor.severity %}
                                        <span class="inline-block mt-2 px-2 py-1 bg-red-600 text-white text-xs rounded">
                                            ì‹¬ê°ë„: {{ factor.severity }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-4xl mb-2">âœ…</p>
                            <p class="text-sm">ì‹¬ê°í•œ ìœ„í—˜ ìš”ì†Œ ì—†ìŒ</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ì£¼ì˜ ìš”ì†Œ -->
                <div class="bg-white rounded-lg shadow border-l-4 border-yellow-500">
                    <div class="px-6 py-4 border-b border-gray-200 bg-yellow-50">
                        <h3 class="text-lg font-bold text-yellow-900">ğŸŸ¡ ì£¼ì˜ ìš”ì†Œ ({{ insights.warning_factors|length }})</h3>
                        <p class="text-xs text-yellow-700 mt-1">ê´€ì°° ë° ëª¨ë‹ˆí„°ë§ í•„ìš”</p>
                    </div>
                    <div class="p-6">
                        {% if insights.warning_factors %}
                        <div class="space-y-3">
                            {% for factor in insights.warning_factors %}
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">{{ factor.icon }}</span>
                                    <div class="flex-1">
                                        <p class="font-semibold text-yellow-900 mb-1">{{ factor.category }}</p>
                                        <p class="text-sm text-gray-700">{{ factor.description }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-4xl mb-2">ğŸ‘</p>
                            <p class="text-sm">íŠ¹ë³„í•œ ì£¼ì˜ ì‚¬í•­ ì—†ìŒ</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ê°•ì  -->
                <div class="bg-white rounded-lg shadow border-l-4 border-green-500">
                    <div class="px-6 py-4 border-b border-gray-200 bg-green-50">
                        <h3 class="text-lg font-bold text-green-900">ğŸŸ¢ ê°•ì  ({{ insights.strengths|length }})</h3>
                        <p class="text-xs text-green-700 mt-1">í•™ìƒì˜ ê¸ì •ì  ì¸¡ë©´</p>
                    </div>
                    <div class="p-6">
                        {% if insights.strengths %}
                        <div class="space-y-3">
                            {% for strength in insights.strengths %}
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">{{ strength.icon }}</span>
                                    <div class="flex-1">
                                        <p class="font-semibold text-green-900 mb-1">{{ strength.category }}</p>
                                        <p class="text-sm text-gray-700">{{ strength.description }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-4xl mb-2">ğŸ“Š</p>
                            <p class="text-sm">ë°ì´í„° ìˆ˜ì§‘ ì¤‘</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ì¶”ì²œ ì•¡ì…˜ -->
                <div class="bg-white rounded-lg shadow border-l-4 border-blue-500">
                    <div class="px-6 py-4 border-b border-gray-200 bg-blue-50">
                        <h3 class="text-lg font-bold text-blue-900">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜ ({{ insights.recommendations|length }})</h3>
                        <p class="text-xs text-blue-700 mt-1">ìš°ì„ ìˆœìœ„ë³„ ì¡°ì¹˜ì‚¬í•­</p>
                    </div>
                    <div class="p-6">
                        {% if insights.recommendations %}
                        <div class="space-y-3">
                            {% for rec in insights.recommendations %}
                            <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition duration-200">
                                <div class="flex items-start gap-3">
                                    <span class="inline-block px-2 py-1 {% if rec.priority == 'high' %}bg-red-100 text-red-800{% elif rec.priority == 'medium' %}bg-yellow-100 text-yellow-800{% else %}bg-blue-100 text-blue-800{% endif %} text-xs font-medium rounded">
                                        {% if rec.priority == 'high' %}ê¸´ê¸‰
                                        {% elif rec.priority == 'medium' %}ì¤‘ìš”
                                        {% else %}ì¼ë°˜
                                        {% endif %}
                                    </span>
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900 mb-1">{{ rec.action }}</p>
                                        <p class="text-xs text-gray-600">ì¹´í…Œê³ ë¦¬: {{ rec.category }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-4xl mb-2">âœ¨</p>
                            <p class="text-sm">ì¶”ì²œì‚¬í•­ ì—†ìŒ</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ë¶„ì„ ë©”íƒ€ ì •ë³´ -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <span>ğŸ¤–</span>
                    <span>AI ê¸°ë°˜ êµì°¨ë¶„ì„ ì¸ì‚¬ì´íŠ¸</span>
                    <span class="text-gray-400">|</span>
                    <span>ë¶„ì„ í•­ëª©: ì¶œì„ë¥ , ìƒë‹´ì´ë ¥, MBTI, í”„ë¡œí•„, í•™ë¶€ëª¨ ì—°ê²°</span>
                </div>
            </div>

            {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ¤–</div>
                <p class="text-gray-700 font-medium">AI ì¸ì‚¬ì´íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>
                <p class="text-sm text-gray-600 mt-2">í•™ìƒ í”„ë¡œí•„, MBTI, ì¶œì„, ìƒë‹´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
    });

    // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });

    // ì„ íƒëœ íƒ­ í™œì„±í™”
    document.getElementById('tab-' + tabName).classList.remove('border-transparent', 'text-gray-500');
    document.getElementById('tab-' + tabName).classList.add('border-blue-500', 'text-blue-600');

    // ì„ íƒëœ ì½˜í…ì¸  í‘œì‹œ
    document.getElementById('content-' + tabName).classList.remove('hidden');

    // ì„ íƒëœ íƒ­ì„ localStorageì— ì €ì¥
    localStorage.setItem('selectedTab_admin', tabName);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ íƒ­ ë˜ëŠ” ê¸°ë³¸ íƒ­ í‘œì‹œ
document.addEventListener('DOMContentLoaded', function() {
    const savedTab = localStorage.getItem('selectedTab_admin') || 'basic';
    showTab(savedTab);
});
</script>
{% endblock %}
