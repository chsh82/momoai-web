{% extends "base.html" %}

{% block title %}ì˜¨ë¼ì¸ ê°•ì˜ì‹¤ ê´€ë¦¬{% endblock %}

{% block page_title %}ğŸ¥ ì¤Œ ë§í¬ ê´€ë¦¬{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">ê°•ì‚¬ë³„ ì¤Œ ë§í¬ ì„¤ì •</span>
{% endblock %}


{% block content %}
<div class="container-fluid">
    <!-- í—¤ë” -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800">ğŸ¥ ì˜¨ë¼ì¸ ê°•ì˜ì‹¤ ê´€ë¦¬</h1>
            <p class="text-gray-600 mt-2">ê°•ì‚¬ë³„ ì¤Œ ë§í¬ ì„¤ì • ë° ì ‘ì† í˜„í™©</p>
        </div>
        <a href="{{ url_for('admin.zoom_access_logs') }}"
           class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
            ğŸ“Š ì ‘ì† ë¡œê·¸ ë³´ê¸°
        </a>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">ì „ì²´ ê°•ì‚¬</p>
                    <p class="text-2xl font-bold text-gray-800">{{ teachers_data|length }}ëª…</p>
                </div>
                <div class="text-blue-500 text-3xl">ğŸ‘¨â€ğŸ«</div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">ì¤Œ ë§í¬ ë“±ë¡</p>
                    <p class="text-2xl font-bold text-green-600">
                        {{ teachers_data|selectattr('has_zoom_link')|list|length }}ëª…
                    </p>
                </div>
                <div class="text-green-500 text-3xl">âœ…</div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">ë¯¸ë“±ë¡</p>
                    <p class="text-2xl font-bold text-orange-600">
                        {{ teachers_data|rejectattr('has_zoom_link')|list|length }}ëª…
                    </p>
                </div>
                <div class="text-orange-500 text-3xl">âš ï¸</div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 text-sm">30ì¼ ì´ ì ‘ì†</p>
                    <p class="text-2xl font-bold text-purple-600">
                        {{ teachers_data|sum(attribute='access_count') }}íšŒ
                    </p>
                </div>
                <div class="text-purple-500 text-3xl">ğŸ“ˆ</div>
            </div>
        </div>
    </div>

    <!-- ê°•ì‚¬ ëª©ë¡ í…Œì´ë¸” -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        ê°•ì‚¬ëª…
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        ì¤Œ ë§í¬ ìƒíƒœ
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        í† í°
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        30ì¼ ì ‘ì†
                    </th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        ìµœê·¼ ì ‘ì†
                    </th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        ê´€ë¦¬
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for data in teachers_data %}
                <tr class="hover:bg-gray-50 transition">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="text-sm font-medium text-gray-900">
                                {{ data.teacher.name }}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if data.has_zoom_link %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                âœ… ë“±ë¡ë¨
                            </span>
                        {% else %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                âš ï¸ ë¯¸ë“±ë¡
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900 font-mono">
                            {{ data.zoom_token }}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {{ data.access_count }}íšŒ
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {% if data.last_access %}
                            {{ data.last_access.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="{{ url_for('admin.edit_zoom_link', teacher_id=data.teacher.user_id) }}"
                           class="text-blue-600 hover:text-blue-900 mr-3">
                            {% if data.has_zoom_link %}ìˆ˜ì •{% else %}ë“±ë¡{% endif %}
                        </a>
                        {% if data.has_zoom_link %}
                        <form action="{{ url_for('admin.delete_zoom_link', teacher_id=data.teacher.user_id) }}"
                              method="POST"
                              class="inline"
                              onsubmit="return confirm('{{ data.teacher.name }} ì„ ìƒë‹˜ì˜ ì¤Œ ë§í¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="text-red-600 hover:text-red-900 mr-3">
                                ì‚­ì œ
                            </button>
                        </form>
                        {% endif %}
                        {% if data.zoom_token != 'ë¯¸ìƒì„±' %}
                        <form action="{{ url_for('admin.regenerate_zoom_token', teacher_id=data.teacher.user_id) }}"
                              method="POST"
                              class="inline"
                              onsubmit="return confirm('í† í°ì„ ì¬ìƒì„±í•˜ë©´ ê¸°ì¡´ ë§í¬ê°€ ë¬´íš¨í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="text-orange-600 hover:text-orange-900">
                                í† í° ì¬ìƒì„±
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ì•ˆë‚´ ì‚¬í•­ -->
    <div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    <strong>ì˜¨ë¼ì¸ ê°•ì˜ì‹¤ ì•ˆë‚´</strong>
                </p>
                <p class="mt-2 text-sm text-blue-700">
                    â€¢ ê°•ì‚¬ë³„ ì¤Œ ë§í¬ë¥¼ ë“±ë¡í•˜ë©´ í•™ìƒë“¤ì´ ìˆ˜ì—… 10ë¶„ ì „ë¶€í„° ì…ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    â€¢ ì‹¤ì œ ì¤Œ URLì€ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ë©°, í•™ìƒë“¤ì—ê²ŒëŠ” í† í° í˜•ì‹ì˜ ì£¼ì†Œê°€ í‘œì‹œë©ë‹ˆë‹¤.<br>
                    â€¢ í† í° í˜•ì‹: momoai-{ì´ë‹ˆì…œ}{ë²ˆí˜¸} (ì˜ˆ: momoai-PSJ001)<br>
                    â€¢ ëª¨ë“  ì ‘ì† ê¸°ë¡ì€ ìë™ìœ¼ë¡œ ë¡œê·¸ì— ì €ì¥ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
