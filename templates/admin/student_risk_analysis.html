{% extends "base.html" %}

{% block title %}í•™ìƒ ìœ„í—˜ë„ ë¶„ì„ - MOMOAI v4.0{% endblock %}

{% block page_title %}ğŸ¤– í•™ìƒ ìœ„í—˜ë„ ë¶„ì„{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">AI ê¸°ë°˜ êµì°¨ë¶„ì„ ëŒ€ì‹œë³´ë“œ</span>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <h2 class="text-3xl font-bold text-gray-800">ğŸ¤– í•™ìƒ ìœ„í—˜ë„ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h2>
        <p class="text-gray-600 mt-2">AI ê¸°ë°˜ êµì°¨ë¶„ì„ì„ í†µí•œ í•™ìƒ ê´€ë¦¬ ìš°ì„ ìˆœìœ„</p>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <!-- ì „ì²´ í•™ìƒ -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-600 mb-1">ì „ì²´ í•™ìƒ</p>
                    <p class="text-3xl font-bold text-gray-800">{{ stats.total }}</p>
                </div>
                <div class="text-4xl">ğŸ‘¥</div>
            </div>
        </div>

        <!-- ë†’ì€ ê´€ì‹¬ í•„ìš” -->
        <div class="bg-red-50 rounded-lg shadow p-6 border-2 border-red-200">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-red-600 font-medium mb-1">ë†’ì€ ê´€ì‹¬ í•„ìš”</p>
                    <p class="text-3xl font-bold text-red-700">{{ stats.high_risk }}</p>
                </div>
                <div class="text-4xl">ğŸ”´</div>
            </div>
            <p class="text-xs text-red-600 mt-2">ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”</p>
        </div>

        <!-- ì£¼ì˜ ê´€ì°° í•„ìš” -->
        <div class="bg-yellow-50 rounded-lg shadow p-6 border-2 border-yellow-200">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-yellow-600 font-medium mb-1">ì£¼ì˜ ê´€ì°° í•„ìš”</p>
                    <p class="text-3xl font-bold text-yellow-700">{{ stats.medium_risk }}</p>
                </div>
                <div class="text-4xl">ğŸŸ¡</div>
            </div>
            <p class="text-xs text-yellow-600 mt-2">ëª¨ë‹ˆí„°ë§ ê¶Œì¥</p>
        </div>

        <!-- ì–‘í˜¸ -->
        <div class="bg-green-50 rounded-lg shadow p-6 border-2 border-green-200">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-green-600 font-medium mb-1">ì–‘í˜¸</p>
                    <p class="text-3xl font-bold text-green-700">{{ stats.low_risk }}</p>
                </div>
                <div class="text-4xl">ğŸŸ¢</div>
            </div>
            <p class="text-xs text-green-600 mt-2">ì •ìƒ ê´€ë¦¬</p>
        </div>
    </div>

    <!-- ë†’ì€ ê´€ì‹¬ í•„ìš” í•™ìƒ -->
    {% if risk_analysis.high_risk %}
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 bg-red-50 border-b-2 border-red-200">
            <h3 class="text-xl font-bold text-red-900">ğŸ”´ ë†’ì€ ê´€ì‹¬ í•„ìš” ({{ risk_analysis.high_risk|length }}ëª…)</h3>
            <p class="text-sm text-red-700 mt-1">ì¦‰ì‹œ ì¡°ì¹˜ê°€ í•„ìš”í•œ í•™ìƒ</p>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for student_data in risk_analysis.high_risk %}
                <a href="{{ url_for('admin.student_profile', student_id=student_data.student.student_id) }}"
                   class="block border-2 border-red-200 rounded-lg p-5 hover:border-red-400 hover:bg-red-50 transition duration-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-4">
                            <div class="text-3xl">ğŸ”´</div>
                            <div>
                                <h4 class="text-lg font-bold text-gray-900">{{ student_data.student.name }}</h4>
                                <p class="text-sm text-gray-600">{{ student_data.student.grade }} | {{ student_data.student.student_id[:8] }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-red-700">{{ student_data.risk_score }}ì </p>
                            <p class="text-xs text-red-600">ìœ„í—˜ë„ ì ìˆ˜</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 pt-3 border-t border-red-200">
                        <div class="text-center">
                            <p class="text-lg font-bold text-red-700">{{ student_data.risk_count }}</p>
                            <p class="text-xs text-gray-600">ìœ„í—˜ ìš”ì†Œ</p>
                        </div>
                        <div class="text-center">
                            <p class="text-lg font-bold text-yellow-700">{{ student_data.warning_count }}</p>
                            <p class="text-xs text-gray-600">ì£¼ì˜ ìš”ì†Œ</p>
                        </div>
                        <div class="text-center">
                            {% if student_data.recent_attendance is not none %}
                            <p class="text-lg font-bold {% if student_data.recent_attendance >= 90 %}text-green-700{% elif student_data.recent_attendance >= 70 %}text-yellow-700{% else %}text-red-700{% endif %}">
                                {{ student_data.recent_attendance }}%
                            </p>
                            {% else %}
                            <p class="text-lg font-bold text-gray-400">-</p>
                            {% endif %}
                            <p class="text-xs text-gray-600">ìµœê·¼ ì¶œì„ë¥ </p>
                        </div>
                    </div>
                    <div class="mt-3 text-right">
                        <span class="text-sm text-red-600 font-medium">ìƒì„¸ ë³´ê¸° â†’</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ì£¼ì˜ ê´€ì°° í•„ìš” í•™ìƒ -->
    {% if risk_analysis.medium_risk %}
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="px-6 py-4 bg-yellow-50 border-b-2 border-yellow-200">
            <h3 class="text-xl font-bold text-yellow-900">ğŸŸ¡ ì£¼ì˜ ê´€ì°° í•„ìš” ({{ risk_analysis.medium_risk|length }}ëª…)</h3>
            <p class="text-sm text-yellow-700 mt-1">ëª¨ë‹ˆí„°ë§ì´ ê¶Œì¥ë˜ëŠ” í•™ìƒ</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for student_data in risk_analysis.medium_risk %}
                <a href="{{ url_for('admin.student_profile', student_id=student_data.student.student_id) }}"
                   class="block border border-yellow-200 rounded-lg p-4 hover:border-yellow-400 hover:bg-yellow-50 transition duration-200">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl">ğŸŸ¡</div>
                            <div>
                                <h4 class="font-bold text-gray-900">{{ student_data.student.name }}</h4>
                                <p class="text-xs text-gray-600">{{ student_data.student.grade }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-yellow-700">{{ student_data.risk_score }}ì </p>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 pt-2 border-t border-yellow-200">
                        <div class="text-center">
                            <p class="text-sm font-bold text-red-700">{{ student_data.risk_count }}</p>
                            <p class="text-xs text-gray-600">ìœ„í—˜</p>
                        </div>
                        <div class="text-center">
                            <p class="text-sm font-bold text-yellow-700">{{ student_data.warning_count }}</p>
                            <p class="text-xs text-gray-600">ì£¼ì˜</p>
                        </div>
                        <div class="text-center">
                            {% if student_data.recent_attendance is not none %}
                            <p class="text-sm font-bold {% if student_data.recent_attendance >= 90 %}text-green-700{% elif student_data.recent_attendance >= 70 %}text-yellow-700{% else %}text-red-700{% endif %}">
                                {{ student_data.recent_attendance }}%
                            </p>
                            {% else %}
                            <p class="text-sm font-bold text-gray-400">-</p>
                            {% endif %}
                            <p class="text-xs text-gray-600">ì¶œì„</p>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ì–‘í˜¸ í•™ìƒ -->
    {% if risk_analysis.low_risk %}
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 bg-green-50 border-b border-green-200 flex items-center justify-between">
            <div>
                <h3 class="text-xl font-bold text-green-900">ğŸŸ¢ ì–‘í˜¸ ({{ risk_analysis.low_risk|length }}ëª…)</h3>
                <p class="text-sm text-green-700 mt-1">ì •ìƒì ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” í•™ìƒ</p>
            </div>
            <button onclick="toggleLowRisk()" id="toggle-btn" class="text-green-700 hover:text-green-900 font-medium text-sm">
                <span id="toggle-text">í¼ì¹˜ê¸° â–¼</span>
            </button>
        </div>
        <div id="low-risk-content" class="hidden p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3">
                {% for student_data in risk_analysis.low_risk %}
                <a href="{{ url_for('admin.student_profile', student_id=student_data.student.student_id) }}"
                   class="block border border-gray-200 rounded-lg p-3 hover:border-green-400 hover:bg-green-50 transition duration-200">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="text-xl">ğŸŸ¢</div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-medium text-gray-900 truncate">{{ student_data.student.name }}</h4>
                            <p class="text-xs text-gray-600 truncate">{{ student_data.student.grade }}</p>
                        </div>
                    </div>
                    {% if student_data.recent_attendance is not none %}
                    <div class="text-center pt-2 border-t border-gray-200">
                        <p class="text-sm font-bold text-green-700">{{ student_data.recent_attendance }}%</p>
                        <p class="text-xs text-gray-600">ì¶œì„ë¥ </p>
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ì•ˆë‚´ -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start gap-3">
            <span class="text-2xl">â„¹ï¸</span>
            <div class="flex-1">
                <p class="text-sm font-medium text-blue-900 mb-2">AI ê¸°ë°˜ êµì°¨ë¶„ì„ ì•ˆë‚´</p>
                <ul class="text-xs text-blue-800 space-y-1">
                    <li>â€¢ ì¶œì„ë¥ , ìƒë‹´ì´ë ¥, MBTI, í”„ë¡œí•„, í•™ë¶€ëª¨ ì—°ê²° ë“± ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.</li>
                    <li>â€¢ ìœ„í—˜ë„ ì ìˆ˜ëŠ” ìë™ìœ¼ë¡œ ê³„ì‚°ë˜ë©°, ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ê´€ì‹¬ì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
                    <li>â€¢ ê° í•™ìƒì„ í´ë¦­í•˜ë©´ ìƒì„¸í•œ ì¸ì‚¬ì´íŠ¸ì™€ ì¶”ì²œ ì•¡ì…˜ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function toggleLowRisk() {
    const content = document.getElementById('low-risk-content');
    const toggleText = document.getElementById('toggle-text');

    if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        toggleText.textContent = 'ì ‘ê¸° â–²';
    } else {
        content.classList.add('hidden');
        toggleText.textContent = 'í¼ì¹˜ê¸° â–¼';
    }
}
</script>
{% endblock %}
