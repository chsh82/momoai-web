{% extends "base.html" %}

{% block title %}ë‚´ í•™ìƒ - MOMOAI v4.0{% endblock %}

{% block page_title %}ğŸ‘¥ í•™ìƒ ê´€ë¦¬{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">ë‚´ í•™ìƒ ëª©ë¡</span>
{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">ë‚´ í•™ìƒ ({{ students|length }}ëª…)</h2>

    <!-- ê²€ìƒ‰ í•„í„° -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <form method="GET" action="{{ url_for('teacher.students') }}">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                <!-- í•™ìƒ ì´ë¦„/ID ê²€ìƒ‰ -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">í•™ìƒ ì´ë¦„ / ID</label>
                    <input type="text"
                           name="search"
                           value="{{ search }}"
                           placeholder="ì´ë¦„ ë˜ëŠ” ID ì…ë ¥..."
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <!-- í•™ë…„ í•„í„° -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">í•™ë…„</label>
                    <select name="grade"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">ì „ì²´ í•™ë…„</option>
                        {% for grade in grades %}
                        <option value="{{ grade }}" {{ 'selected' if grade_filter == grade else '' }}>
                            {{ grade }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- ìˆ˜ì—… í˜•íƒœ í•„í„° -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìˆ˜ì—… í˜•íƒœ</label>
                    <select name="course_type"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">ì „ì²´ í˜•íƒœ</option>
                        {% for course_type in course_types %}
                        <option value="{{ course_type }}" {{ 'selected' if course_type_filter == course_type else '' }}>
                            {{ course_type }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <div class="flex gap-3">
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition duration-200 flex items-center gap-2">
                    <span>ğŸ”</span>
                    <span>ê²€ìƒ‰</span>
                </button>
                {% if search or grade_filter or course_type_filter %}
                <a href="{{ url_for('teacher.students') }}"
                   class="bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-lg font-medium transition duration-200 flex items-center gap-2">
                    <span>ğŸ”„</span>
                    <span>ì´ˆê¸°í™”</span>
                </a>
                {% endif %}
                <div class="ml-auto text-sm text-gray-600 flex items-center">
                    {% if search or grade_filter or course_type_filter %}
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-medium">
                        í•„í„° ì ìš© ì¤‘: {{ students|length }}ëª…
                    </span>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>

    <!-- í•™ìƒ ëª©ë¡ -->
    {% if students %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for student_data in students %}
        <div class="bg-white rounded-lg shadow hover:shadow-lg transition duration-200">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-lg">
                        {{ student_data.student.name[0] }}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold text-gray-800">{{ student_data.student.name }}</h3>
                            {% if student_data.student.tier %}
                            <span class="px-2 py-1 text-xs font-medium rounded
                                {% if student_data.student.tier == 'A' %}bg-red-100 text-red-800
                                {% elif student_data.student.tier == 'B' %}bg-blue-100 text-blue-800
                                {% elif student_data.student.tier == 'C' %}bg-green-100 text-green-800
                                {% elif student_data.student.tier == 'VIP' %}bg-purple-100 text-purple-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ student_data.student.tier }}
                            </span>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-600">{{ student_data.student.grade }}</p>
                    </div>
                </div>

                <div class="space-y-2 text-sm text-gray-700 mb-4">
                    <p>ğŸ“š ìˆ˜ê°• ìˆ˜ì—…: {{ student_data.enrollment_count }}ê°œ</p>
                    <p>ğŸ“Š í‰ê·  ì¶œì„ë¥ : {{ "%.1f"|format(student_data.avg_attendance_rate) }}%</p>
                </div>

                <div class="mb-4">
                    <p class="text-xs text-gray-600 mb-2">ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…:</p>
                    <div class="flex flex-wrap gap-1">
                        {% for course in student_data.courses %}
                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded">
                            {{ course.course_name }}
                        </span>
                        {% endfor %}
                    </div>
                </div>

                <div class="flex flex-col gap-2">
                    <div class="flex gap-2">
                        <a href="{{ url_for('teacher.student_detail', student_id=student_data.student.student_id) }}"
                           class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                            ìƒì„¸ë³´ê¸°
                        </a>
                        <a href="{{ url_for('teacher.create_feedback') }}?student_id={{ student_data.student.student_id }}"
                           class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                            í”¼ë“œë°±
                        </a>
                    </div>
                    <a href="{{ url_for('teacher.ace_weekly_report', student_id=student_data.student.student_id) }}"
                       class="bg-purple-600 hover:bg-purple-700 text-white text-center text-sm font-medium py-2 rounded transition duration-200">
                        ğŸ“Š ì£¼ê°„í‰ê°€ ë¦¬í¬íŠ¸
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500 text-lg">ë‹´ë‹¹í•˜ëŠ” í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
