{% extends "base.html" %}

{% block title %}{{ student.name }} - í•™ìƒ ì¢…í•© ì •ë³´{% endblock %}

{% block page_title %}ğŸ‘¤ {{ student.name }} í•™ìƒ ì •ë³´{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">{{ student.grade }}</span>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
                <a href="{{ url_for('teacher.students') }}"
                   class="text-blue-600 hover:text-blue-800 font-medium">
                    â† í•™ìƒ ëª©ë¡
                </a>
                <h2 class="text-3xl font-bold text-gray-800">{{ student.name }}</h2>
                <span class="px-3 py-1 {% if student.tier == 'VIP' %}bg-yellow-100 text-yellow-800{% elif student.tier == 'A' %}bg-green-100 text-green-800{% elif student.tier == 'B' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-800{% endif %} text-sm font-medium rounded-full">
                    {{ student.tier }}
                </span>
            </div>
        </div>
        <p class="text-gray-600">{{ student.grade }} | {{ student.student_code }}</p>
    </div>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="border-b border-gray-200">
            <nav class="flex -mb-px">
                <button onclick="showTab('basic')" id="tab-basic"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-blue-500 text-blue-600">
                    ğŸ“‹ ê¸°ë³¸ì •ë³´
                </button>
                <button onclick="showTab('profile')" id="tab-profile"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ“ í”„ë¡œí•„
                </button>
                <button onclick="showTab('mbti')" id="tab-mbti"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ§  MBTI
                </button>
                <button onclick="showTab('consultation')" id="tab-consultation"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ’¬ ìƒë‹´ì´ë ¥
                </button>
                <button onclick="showTab('insights')" id="tab-insights"
                        class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ğŸ¤– AI ì¸ì‚¬ì´íŠ¸
                </button>
            </nav>
        </div>
    </div>

    <!-- íƒ­ ì½˜í…ì¸  -->
    <div id="tab-content">
        <!-- ê¸°ë³¸ì •ë³´ íƒ­ -->
        <div id="content-basic" class="tab-content">
            <!-- í•™ìƒ ì •ë³´ ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">í•™ìƒ ì •ë³´</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div class="text-sm text-gray-600 mb-1">í•™ìƒ ì½”ë“œ</div>
                            <div class="font-medium">{{ student.student_code }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">í•™ë…„</div>
                            <div class="font-medium">{{ student.grade }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ì´ë©”ì¼</div>
                            <div class="font-medium">{{ student.email or '-' }}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 mb-1">ì „í™”ë²ˆí˜¸</div>
                            <div class="font-medium">{{ student.phone or '-' }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•™ë¶€ëª¨ ì •ë³´ -->
            {% if parents %}
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800">í•™ë¶€ëª¨ ì •ë³´</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        {% for parent in parents %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <div class="font-medium">{{ parent.name }}</div>
                                <div class="text-sm text-gray-600">{{ parent.email }}</div>
                                {% if parent.phone %}
                                <div class="text-sm text-gray-600">ğŸ“ {{ parent.phone }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ìˆ˜ê°• ë‚´ì—­ -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800">ìˆ˜ê°• ë‚´ì—­</h3>
                    <span class="text-sm text-gray-600">ì´ {{ enrollments|length }}ê°œ ìˆ˜ì—…</span>
                </div>
                <div class="p-6">
                    {% if enrollments %}
                    <div class="space-y-4">
                        {% for enrollment in enrollments %}
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition">
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <div class="font-medium text-lg">{{ enrollment.course.name }}</div>
                                    <div class="text-sm text-gray-600">{{ enrollment.course.course_type }} | {{ enrollment.course.grade }}</div>
                                </div>
                                <span class="px-3 py-1 {% if enrollment.status == 'active' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %} text-sm font-medium rounded-full">
                                    {% if enrollment.status == 'active' %}ìˆ˜ê°•ì¤‘{% else %}ì¢…ë£Œ{% endif %}
                                </span>
                            </div>

                            <!-- ì¶œì„ í†µê³„ -->
                            <div class="grid grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600">{{ enrollment.attended_sessions }}</div>
                                    <div class="text-xs text-gray-600">ì¶œì„</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-600">{{ enrollment.late_sessions }}</div>
                                    <div class="text-xs text-gray-600">ì§€ê°</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600">{{ enrollment.absent_sessions }}</div>
                                    <div class="text-xs text-gray-600">ê²°ì„</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600">
                                        {% set total = enrollment.attended_sessions + enrollment.late_sessions + enrollment.absent_sessions %}
                                        {% if total > 0 %}
                                            {{ ((enrollment.attended_sessions / total) * 100)|round(1) }}%
                                        {% else %}
                                            0%
                                        {% endif %}
                                    </div>
                                    <div class="text-xs text-gray-600">ì¶œì„ë¥ </div>
                                </div>
                            </div>

                            <div class="mt-4">
                                <a href="{{ url_for('teacher.course_detail', course_id=enrollment.course_id) }}"
                                   class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    ìˆ˜ì—… ìƒì„¸ ë³´ê¸° â†’
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“š</div>
                        <p>ìˆ˜ê°• ì¤‘ì¸ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- í”¼ë“œë°± ì´ë ¥ -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800">ë‚´ê°€ ì‘ì„±í•œ í”¼ë“œë°±</h3>
                    <a href="{{ url_for('teacher.create_feedback', student_id=student.student_id) }}"
                       class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                        + ìƒˆ í”¼ë“œë°± ì‘ì„±
                    </a>
                </div>
                <div class="p-6">
                    {% if feedbacks %}
                    <div class="space-y-4">
                        {% for feedback in feedbacks %}
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-sm text-gray-600">
                                    {{ feedback.created_at.strftime('%Yë…„ %mì›” %dì¼') }}
                                </div>
                                <span class="px-2 py-1 {% if feedback.feedback_type == 'positive' %}bg-green-100 text-green-800{% elif feedback.feedback_type == 'improvement' %}bg-orange-100 text-orange-800{% else %}bg-blue-100 text-blue-800{% endif %} text-xs rounded-full">
                                    {% if feedback.feedback_type == 'positive' %}ì¹­ì°¬{% elif feedback.feedback_type == 'improvement' %}ê°œì„ {% else %}ì¼ë°˜{% endif %}
                                </span>
                            </div>
                            <div class="text-gray-700 mb-2">{{ feedback.content }}</div>
                            {% if feedback.hidden_from_student %}
                            <div class="text-xs text-gray-500 flex items-center gap-1">
                                <span>ğŸ”’</span>
                                <span>í•™ìƒì—ê²Œ ë¹„ê³µê°œ (í•™ë¶€ëª¨ë§Œ í™•ì¸ ê°€ëŠ¥)</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ’­</div>
                        <p>ì‘ì„±í•œ í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm mt-2">í•™ìƒì˜ í•™ìŠµ ìƒí™©ì„ í•™ë¶€ëª¨ë‹˜ê»˜ ê³µìœ í•´ë³´ì„¸ìš”.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- í”„ë¡œí•„ íƒ­ -->
        <div id="content-profile" class="tab-content hidden">
            {% if profile %}
            <!-- ì£¼ìš” íŠ¹ì§• ì¹´ë“œ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-5 border border-blue-200">
                    <h3 class="text-sm font-semibold text-blue-900 mb-3">ğŸ“š ë…ì„œ ì—­ëŸ‰</h3>
                    <div class="text-3xl font-bold text-blue-700 mb-1">
                        {% if profile.reading_competency %}{{ profile.reading_competency }}/5{% else %}-{% endif %}
                    </div>
                    <div class="text-xs text-blue-600">
                        {% if profile.weekly_reading_amount %}{{ profile.weekly_reading_amount }}{% endif %}
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-5 border border-green-200">
                    <h3 class="text-sm font-semibold text-green-900 mb-3">âœï¸ ìˆ˜ì—… ê²½í—˜</h3>
                    <div class="text-lg font-bold text-green-700 mb-1">
                        {% if profile.reading_experience %}{{ profile.reading_experience }}{% else %}ì—†ìŒ{% endif %}
                    </div>
                    <div class="text-xs text-green-600">ë…ì„œë…¼ìˆ  ìˆ˜ì—…</div>
                </div>

                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-5 border border-purple-200">
                    <h3 class="text-sm font-semibold text-purple-900 mb-3">ğŸ¯ ì§„í•™ ëª©í‘œ</h3>
                    <div class="text-sm font-medium text-purple-700 line-clamp-2">
                        {% if profile.academic_goals_list %}
                        {{ profile.academic_goals_list[0] }}
                        {% if profile.academic_goals_list|length > 1 %}<span class="text-xs">ì™¸ {{ profile.academic_goals_list|length - 1 }}ê°œ</span>{% endif %}
                        {% else %}ë¯¸ì •{% endif %}
                    </div>
                </div>

                <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-5 border border-orange-200">
                    <h3 class="text-sm font-semibold text-orange-900 mb-3">ğŸ‘¤ í•™ìƒ ì„±í–¥</h3>
                    <div class="text-sm font-medium text-orange-700 line-clamp-2">
                        {% if profile.personality_traits_list %}
                        {{ profile.personality_traits_list[0] }}
                        {% if profile.personality_traits_list|length > 1 %}<span class="text-xs">ì™¸ {{ profile.personality_traits_list|length - 1 }}ê°œ</span>{% endif %}
                        {% else %}-{% endif %}
                    </div>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ê¸°ë³¸ ì •ë³´</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-1">ì¬í•™ í•™êµ</p>
                            <p class="font-medium text-gray-800">{{ profile.current_school or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">í•™ë¶€ëª¨ ì—°ë½ì²˜</p>
                            <p class="font-medium text-gray-800">{{ profile.parent_contact or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">ì£¼ì†Œ</p>
                            <p class="font-medium text-gray-800">{{ profile.address or '-' }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ë…ì„œ ì„±í–¥</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-2">ì„ í˜¸ ë…ì„œ ë¶„ì•¼</p>
                            <div class="flex flex-wrap gap-2">
                                {% for genre in profile.preferred_genres_list %}
                                <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ genre }}</span>
                                {% else %}
                                <p class="text-gray-500">-</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-800">ìˆ˜ì—… ëª©í‘œ</h3>
                    </div>
                    <div class="p-6 space-y-3 text-sm">
                        <div>
                            <p class="text-gray-600 mb-1">ì£¼ìš” í–¥ìƒ ëª©í‘œ</p>
                            <p class="font-medium text-gray-800">{{ profile.main_improvement_goal or '-' }}</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">ì„ í˜¸ ìˆ˜ì—… ìŠ¤íƒ€ì¼</p>
                            <p class="font-medium text-gray-800">{{ profile.preferred_class_style or '-' }}</p>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ“‹</div>
                <p class="text-gray-700 font-medium">ì•„ì§ ê¸°ì´ˆ ì¡°ì‚¬ í”„ë¡œí•„ì´ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>

        <!-- MBTI íƒ­ -->
        <div id="content-mbti" class="tab-content hidden">
            {% if mbti_result and mbti_type %}
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg shadow-lg p-6 mb-6 border-2 border-purple-200">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-purple-900 mb-2">{{ mbti_type.type_name }}</h3>
                    <p class="text-purple-700">{{ mbti_result.type_combination }}</p>
                    <p class="text-sm text-gray-600 mt-2">í…ŒìŠ¤íŠ¸ ì¼ì‹œ: {{ mbti_result.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                </div>

                <div class="bg-white bg-opacity-60 rounded-lg p-4 mb-4">
                    <p class="text-sm text-purple-600 font-medium mb-2">íŠ¹ì§•</p>
                    <p class="text-gray-800">{{ mbti_type.full_description or '-' }}</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-blue-600 font-bold mb-2">ğŸ“– ì½ê¸°</p>
                        <p class="text-lg font-bold text-blue-900">{{ mbti_result.read_type }}</p>
                    </div>
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-green-600 font-bold mb-2">ğŸ’¬ ë§í•˜ê¸°</p>
                        <p class="text-lg font-bold text-green-900">{{ mbti_result.speech_type }}</p>
                    </div>
                    <div class="bg-white bg-opacity-60 rounded-lg p-4">
                        <p class="text-xs text-orange-600 font-bold mb-2">âœï¸ ì“°ê¸°</p>
                        <p class="text-lg font-bold text-orange-900">{{ mbti_result.write_type }}</p>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center">
                <div class="text-5xl mb-4">ğŸ§ </div>
                <p class="text-gray-700 font-medium">ì•„ì§ MBTI í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>

        <!-- ìƒë‹´ì´ë ¥ íƒ­ -->
        <div id="content-consultation" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ’¬ ìƒë‹´ ì´ë ¥</h3>
                    <span class="text-sm text-gray-600">ìµœê·¼ 10ê±´</span>
                </div>
                <div class="p-6">
                    {% if consultations %}
                    <div class="space-y-3">
                        {% for consultation in consultations %}
                        <a href="{{ url_for('teacher.consultation_detail', consultation_id=consultation.consultation_id) }}"
                           class="block border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50 transition">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-1 rounded">
                                        {{ consultation.major_category }}
                                    </span>
                                    {% if consultation.sub_category %}
                                    <span class="bg-gray-100 text-gray-700 text-xs font-medium px-2.5 py-1 rounded">
                                        {{ consultation.sub_category }}
                                    </span>
                                    {% endif %}
                                </div>
                                <span class="text-xs text-gray-500">{{ consultation.consultation_date.strftime('%Y-%m-%d') }}</span>
                            </div>
                            <p class="text-sm font-medium text-gray-800 mb-1">{{ consultation.title }}</p>
                            <p class="text-xs text-gray-600 line-clamp-1">{{ consultation.content }}</p>
                            <div class="flex items-center gap-2 mt-2 text-xs text-gray-500">
                                <span>ğŸ‘¤ {{ consultation.counselor.name }}</span>
                                <span class="text-gray-400">â€¢</span>
                                <span class="text-blue-600">ìƒì„¸ë³´ê¸° â†’</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-4xl mb-3">ğŸ“­</div>
                        <p>ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- AI ì¸ì‚¬ì´íŠ¸ íƒ­ -->
        <div id="content-insights" class="tab-content hidden">
            <!-- ì „ì²´ ìƒíƒœ ì¹´ë“œ -->
            <div class="mb-6 p-6 rounded-lg {% if insights.overall_color == 'red' %}bg-red-50 border-2 border-red-300{% elif insights.overall_color == 'yellow' %}bg-yellow-50 border-2 border-yellow-300{% else %}bg-green-50 border-2 border-green-300{% endif %}">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold {% if insights.overall_color == 'red' %}text-red-900{% elif insights.overall_color == 'yellow' %}text-yellow-900{% else %}text-green-900{% endif %}">
                            ì¢…í•© ìƒíƒœ: {{ insights.overall_label }}
                        </h3>
                        <p class="text-sm {% if insights.overall_color == 'red' %}text-red-700{% elif insights.overall_color == 'yellow' %}text-yellow-700{% else %}text-green-700{% endif %} mt-1">
                            ìœ„í—˜ ìš”ì†Œ {{ insights.risk_factors|length }}ê°œ, ì£¼ì˜ ìš”ì†Œ {{ insights.warning_factors|length }}ê°œ
                        </p>
                    </div>
                    <div class="text-5xl">
                        {% if insights.overall_color == 'red' %}ğŸ”´
                        {% elif insights.overall_color == 'yellow' %}ğŸŸ¡
                        {% else %}ğŸŸ¢{% endif %}
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- ìœ„í—˜ ìš”ì†Œ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 bg-red-50">
                        <h3 class="text-lg font-bold text-red-900">ğŸ”´ ìœ„í—˜ ìš”ì†Œ</h3>
                    </div>
                    <div class="p-6">
                        {% if insights.risk_factors %}
                        <div class="space-y-3">
                            {% for factor in insights.risk_factors %}
                            <div class="flex items-start gap-3 p-3 bg-red-50 rounded-lg border border-red-200">
                                <span class="text-2xl">{{ factor.icon }}</span>
                                <div class="flex-1">
                                    <p class="font-medium text-red-900 text-sm">{{ factor.category }}</p>
                                    <p class="text-sm text-red-800 mt-1">{{ factor.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-sm">ìœ„í—˜ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤ âœ“</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ì£¼ì˜ ìš”ì†Œ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 bg-yellow-50">
                        <h3 class="text-lg font-bold text-yellow-900">ğŸŸ¡ ì£¼ì˜ ìš”ì†Œ</h3>
                    </div>
                    <div class="p-6">
                        {% if insights.warning_factors %}
                        <div class="space-y-3">
                            {% for factor in insights.warning_factors %}
                            <div class="flex items-start gap-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                <span class="text-2xl">{{ factor.icon }}</span>
                                <div class="flex-1">
                                    <p class="font-medium text-yellow-900 text-sm">{{ factor.category }}</p>
                                    <p class="text-sm text-yellow-800 mt-1">{{ factor.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-sm">ì£¼ì˜ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤ âœ“</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ê°•ì  -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 bg-green-50">
                        <h3 class="text-lg font-bold text-green-900">ğŸŸ¢ ê°•ì </h3>
                    </div>
                    <div class="p-6">
                        {% if insights.strengths %}
                        <div class="space-y-3">
                            {% for strength in insights.strengths %}
                            <div class="flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                <span class="text-2xl">{{ strength.icon }}</span>
                                <div class="flex-1">
                                    <p class="font-medium text-green-900 text-sm">{{ strength.category }}</p>
                                    <p class="text-sm text-green-800 mt-1">{{ strength.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-sm">ë°ì´í„° ë¶€ì¡±</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ì¶”ì²œ ì•¡ì…˜ -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 bg-blue-50">
                        <h3 class="text-lg font-bold text-blue-900">ğŸ’¡ ì¶”ì²œ ì•¡ì…˜</h3>
                    </div>
                    <div class="p-6">
                        {% if insights.recommendations %}
                        <div class="space-y-3">
                            {% for rec in insights.recommendations %}
                            <div class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <span class="text-lg {% if rec.priority == 'high' %}text-red-600{% elif rec.priority == 'medium' %}text-yellow-600{% else %}text-blue-600{% endif %}">
                                    {% if rec.priority == 'high' %}ğŸ”¥
                                    {% elif rec.priority == 'medium' %}âš ï¸
                                    {% else %}ğŸ’¡{% endif %}
                                </span>
                                <div class="flex-1">
                                    <p class="font-medium text-blue-900 text-sm">{{ rec.category }}</p>
                                    <p class="text-sm text-blue-800 mt-1">{{ rec.action }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-sm">ì¶”ì²œ ì•¡ì…˜ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <p class="text-xs text-gray-600 text-center">
                    ğŸ’¡ AI ì¸ì‚¬ì´íŠ¸ëŠ” ì¶œì„ë¥ , ìƒë‹´ì´ë ¥, MBTI, í”„ë¡œí•„ ë°ì´í„°ë¥¼ êµì°¨ë¶„ì„í•˜ì—¬ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
                    ì‹¤ì œ ìƒë‹´ ì‹œ ì°¸ê³ ìë£Œë¡œë§Œ í™œìš©í•´ì£¼ì„¸ìš”.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
    });

    // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });

    // ì„ íƒëœ íƒ­ í™œì„±í™”
    document.getElementById('tab-' + tabName).classList.remove('border-transparent', 'text-gray-500');
    document.getElementById('tab-' + tabName).classList.add('border-blue-500', 'text-blue-600');

    // ì„ íƒëœ ì½˜í…ì¸  í‘œì‹œ
    document.getElementById('content-' + tabName).classList.remove('hidden');

    // ì„ íƒëœ íƒ­ì„ localStorageì— ì €ì¥
    localStorage.setItem('selectedTab', tabName);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ íƒ­ ë˜ëŠ” ê¸°ë³¸ íƒ­ í‘œì‹œ
document.addEventListener('DOMContentLoaded', function() {
    const savedTab = localStorage.getItem('selectedTab') || 'basic';
    showTab(savedTab);
});
</script>
{% endblock %}
