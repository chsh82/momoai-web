{% extends "base.html" %}

{% block title %}í•™ìƒ ë…ì„œ ë…¼ìˆ  MBTI - êµì‚¬ í¬í„¸{% endblock %}

{% block page_title %}ğŸ§  ë…ì„œë…¼ìˆ  MBTI{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">í•™ìƒ ì„±í–¥ ë¶„ì„</span>
{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-3xl font-bold text-gray-800">ğŸ“š í•™ìƒ ë…ì„œ ë…¼ìˆ  MBTI ë¶„ì„</h2>
            <a href="{{ url_for('teacher.index') }}"
               class="text-blue-600 hover:text-blue-800 font-medium">
                â† ëŒ€ì‹œë³´ë“œ
            </a>
        </div>
        <p class="text-gray-600">
            ë‹´ë‹¹ í•™ìƒë“¤ì˜ ë…ì„œ, ë°œí‘œ/í† ë¡ , ì“°ê¸° ìŠ¤íƒ€ì¼ì„ í™•ì¸í•˜ê³  ë§ì¶¤í˜• êµìœ¡ ì „ëµì„ ìˆ˜ë¦½í•˜ì„¸ìš”.
        </p>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between mb-2">
                <div class="text-3xl">ğŸ‘¥</div>
                <div class="text-2xl font-bold text-gray-800">{{ my_students|length }}</div>
            </div>
            <div class="text-sm text-gray-600">ì „ì²´ í•™ìƒ</div>
        </div>
        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <div class="text-3xl">âœ…</div>
                <div class="text-2xl font-bold text-green-700">{{ total_tested }}</div>
            </div>
            <div class="text-sm text-green-700">ê²€ì‚¬ ì™„ë£Œ</div>
        </div>
        <div class="bg-orange-50 border border-orange-200 rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <div class="text-3xl">â³</div>
                <div class="text-2xl font-bold text-orange-700">{{ my_students|length - total_tested }}</div>
            </div>
            <div class="text-sm text-orange-700">ë¯¸ê²€ì‚¬</div>
        </div>
        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <div class="text-3xl">ğŸ¯</div>
                <div class="text-2xl font-bold text-purple-700">{{ type_distribution|length }}</div>
            </div>
            <div class="text-sm text-purple-700">ë°œê²¬ëœ ìœ í˜•</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- ë…í•´ë ¥ ìˆ˜ì¤€ ë¶„í¬ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ“–</span>
                ë…í•´ë ¥ ìˆ˜ì¤€ ë¶„í¬
            </h3>
            <div class="space-y-3">
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì´ˆê¸‰ (ê¸°ë³¸ ë¬¸í•´ë ¥)</span>
                        <span class="text-sm font-medium text-purple-400">{{ read_distribution.beginner }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-purple-400" style="width: {{ (read_distribution.beginner / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì¤‘ê¸‰ (êµ¬ì¡°ì  ë…í•´)</span>
                        <span class="text-sm font-medium text-purple-500">{{ read_distribution.intermediate }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-purple-500" style="width: {{ (read_distribution.intermediate / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ê³ ê¸‰ (ë¹„íŒì  ë…í•´)</span>
                        <span class="text-sm font-medium text-purple-600">{{ read_distribution.advanced }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-purple-600" style="width: {{ (read_distribution.advanced / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ê³ ë ¥ ìˆ˜ì¤€ ë¶„í¬ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ’¬</span>
                ì‚¬ê³ ë ¥ ìˆ˜ì¤€ ë¶„í¬
            </h3>
            <div class="space-y-3">
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì´ˆê¸‰ (ë‚´ìš© ì „ë‹¬)</span>
                        <span class="text-sm font-medium text-indigo-400">{{ speech_distribution.beginner }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-indigo-400" style="width: {{ (speech_distribution.beginner / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì¤‘ê¸‰ (ë…¼ë¦¬ì  í‘œí˜„)</span>
                        <span class="text-sm font-medium text-indigo-500">{{ speech_distribution.intermediate }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-indigo-500" style="width: {{ (speech_distribution.intermediate / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ê³ ê¸‰ (ì°½ì˜ì  í™•ì¥)</span>
                        <span class="text-sm font-medium text-indigo-600">{{ speech_distribution.advanced }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-indigo-600" style="width: {{ (speech_distribution.advanced / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„œìˆ ë ¥ ìˆ˜ì¤€ ë¶„í¬ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">âœï¸</span>
                ì„œìˆ ë ¥ ìˆ˜ì¤€ ë¶„í¬
            </h3>
            <div class="space-y-3">
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì´ˆê¸‰ (ê°„ê²°í•œ ìš”ì•½)</span>
                        <span class="text-sm font-medium text-pink-400">{{ write_distribution.beginner }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-pink-400" style="width: {{ (write_distribution.beginner / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ì¤‘ê¸‰ (ì²´ê³„ì  êµ¬ì„±)</span>
                        <span class="text-sm font-medium text-pink-500">{{ write_distribution.intermediate }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-pink-500" style="width: {{ (write_distribution.intermediate / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">ê³ ê¸‰ (ì°½ì˜ì  ì¬êµ¬ì„±)</span>
                        <span class="text-sm font-medium text-pink-600">{{ write_distribution.advanced }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-pink-600" style="width: {{ (write_distribution.advanced / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìœ í˜•ë³„ ë¶„í¬ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ¯</span>
                ìƒìœ„ ìœ í˜• (Top 5)
            </h3>
            {% if type_distribution %}
            <div class="space-y-3">
                {% for type_name, data in (type_distribution.items()|sort(attribute='1.count', reverse=true))[:5] %}
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm text-gray-700">{{ type_name }}</span>
                        <span class="text-sm font-medium text-purple-600">{{ data.count }}ëª…</span>
                    </div>
                    <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-purple-500 to-indigo-600"
                             style="width: {{ (data.count / total_tested * 100) if total_tested > 0 else 0 }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500">
                <div class="text-4xl mb-2">ğŸ“Š</div>
                <p>ê²€ì‚¬ ì™„ë£Œëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- í•™ìƒ ëª©ë¡ -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">í•™ìƒë³„ ê²°ê³¼</h3>
        </div>
        <div class="p-6">
            {% if my_students %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">í•™ìƒ</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">í•™ë…„</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ìœ í˜•</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ê²€ì‚¬ì¼</th>
                            <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">ìƒì„¸</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for student in my_students %}
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <div class="font-medium text-gray-800">{{ student.name }}</div>
                            </td>
                            <td class="px-4 py-3 text-gray-600">{{ student.grade }}</td>
                            <td class="px-4 py-3">
                                {% if student.student_id in latest_results %}
                                <span class="px-3 py-1 bg-purple-100 text-purple-700 text-sm font-medium rounded-full">
                                    {{ latest_results[student.student_id].mbti_type.type_name }}
                                </span>
                                {% else %}
                                <span class="px-3 py-1 bg-gray-100 text-gray-500 text-sm rounded-full">
                                    ë¯¸ê²€ì‚¬
                                </span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {% if student.student_id in latest_results %}
                                {{ latest_results[student.student_id].created_at.strftime('%Y-%m-%d') }}
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 text-center">
                                {% if student.student_id in latest_results %}
                                <a href="{{ url_for('teacher.view_student_mbti', student_id=student.student_id) }}"
                                   class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    ìƒì„¸ ë³´ê¸° â†’
                                </a>
                                {% else %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-12 text-gray-500">
                <div class="text-4xl mb-4">ğŸ‘¥</div>
                <p>ë‹´ë‹¹ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
