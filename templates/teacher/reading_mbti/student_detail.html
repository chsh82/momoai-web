{% extends "base.html" %}

{% block title %}{{ student.name }} - ë…ì„œ ë…¼ìˆ  MBTI - êµì‚¬ í¬í„¸{% endblock %}

{% block page_title %}ğŸ§  í•™ìƒ MBTI ìƒì„¸{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
                <a href="{{ url_for('teacher.reading_mbti') }}"
                   class="text-blue-600 hover:text-blue-800 font-medium">
                    â† ëª©ë¡
                </a>
                <h2 class="text-3xl font-bold text-gray-800">{{ student.name }} í•™ìƒ MBTI ë¶„ì„</h2>
            </div>
            <div class="text-sm text-gray-600">
                {{ student.grade }} | {{ student.student_code }}
            </div>
        </div>
    </div>

    {% if all_results %}
    <!-- ìµœì‹  ê²°ê³¼ ì¹´ë“œ -->
    <div class="bg-gradient-to-br from-purple-500 via-indigo-600 to-purple-700 rounded-lg shadow-xl p-8 text-white mb-8">
        <div class="flex items-center justify-between mb-6">
            <div>
                <div class="text-sm text-purple-100 mb-2">ìµœì‹  ê²€ì‚¬ ê²°ê³¼ ({{ latest_result.created_at.strftime('%Yë…„ %mì›” %dì¼') }})</div>
                <div class="text-4xl font-bold mb-2">{{ latest_result.mbti_type.type_name }}</div>
                <div class="text-xl text-purple-100">{{ latest_result.mbti_type.combo_description }}</div>
            </div>
            <div class="text-center">
                <div class="text-6xl mb-2">ğŸ¯</div>
                <div class="inline-block bg-white/20 rounded-full px-6 py-2 text-lg font-medium">
                    {{ latest_result.mbti_type.type_code }}
                </div>
            </div>
        </div>

        <div class="bg-white/10 rounded-lg p-6 backdrop-blur-sm">
            <p class="text-lg leading-relaxed">
                {{ latest_result.mbti_type.full_description }}
            </p>
        </div>
    </div>

    <!-- ìµœì‹  ì ìˆ˜ ë¶„ì„ -->
    <div class="bg-white rounded-lg shadow mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">ì—­ëŸ‰ í”„ë¡œí•„</h3>
        </div>
        <div class="p-6">
            <!-- ë ˆì´ë” ì°¨íŠ¸ -->
            <div class="mb-8">
                <div class="max-w-2xl mx-auto">
                    <canvas id="radarChart" height="300"></canvas>
                </div>
            </div>

            <!-- ìƒì„¸ ì ìˆ˜ (ì ‘ê¸° ê°€ëŠ¥) -->
            <details>
                <summary class="cursor-pointer text-gray-700 font-medium hover:text-purple-600 transition mb-4">
                    ğŸ“‹ ìƒì„¸ ì ìˆ˜ ë³´ê¸°
                </summary>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- ë…í•´ë ¥ ì˜ì—­ -->
                <div>
                    <div class="font-medium text-gray-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">ğŸ“–</span>
                        ë…í•´ë ¥ (ì½ê¸° ì—­ëŸ‰)
                    </div>
                    <div class="space-y-3">
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì´ˆê¸‰ (ê¸°ë³¸ ë¬¸í•´ë ¥)</span>
                                <span class="text-sm font-medium text-purple-600">
                                    {{ latest_result.scores.read.beginner }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-purple-400"
                                     style="width: {{ (latest_result.scores.read.beginner / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì¤‘ê¸‰ (êµ¬ì¡°ì  ë…í•´)</span>
                                <span class="text-sm font-medium text-purple-600">
                                    {{ latest_result.scores.read.intermediate }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-purple-500"
                                     style="width: {{ (latest_result.scores.read.intermediate / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ê³ ê¸‰ (ë¹„íŒì  ë…í•´)</span>
                                <span class="text-sm font-medium text-purple-600">
                                    {{ latest_result.scores.read.advanced }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-purple-600"
                                     style="width: {{ (latest_result.scores.read.advanced / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">ë…í•´ë ¥ ì´ì </span>
                                <span class="text-base font-bold text-purple-600">
                                    {{ latest_result.scores.read.beginner + latest_result.scores.read.intermediate + latest_result.scores.read.advanced }}ì 
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ê³ ë ¥ ì˜ì—­ -->
                <div>
                    <div class="font-medium text-gray-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">ğŸ’¬</span>
                        ì‚¬ê³ ë ¥ (ë°œí‘œ/í† ë¡ )
                    </div>
                    <div class="space-y-3">
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì´ˆê¸‰ (ë‚´ìš© ì „ë‹¬)</span>
                                <span class="text-sm font-medium text-indigo-600">
                                    {{ latest_result.scores.speech.beginner }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-indigo-400"
                                     style="width: {{ (latest_result.scores.speech.beginner / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì¤‘ê¸‰ (ë…¼ë¦¬ì  í‘œí˜„)</span>
                                <span class="text-sm font-medium text-indigo-600">
                                    {{ latest_result.scores.speech.intermediate }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-indigo-500"
                                     style="width: {{ (latest_result.scores.speech.intermediate / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ê³ ê¸‰ (ì°½ì˜ì  í™•ì¥)</span>
                                <span class="text-sm font-medium text-indigo-600">
                                    {{ latest_result.scores.speech.advanced }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-indigo-600"
                                     style="width: {{ (latest_result.scores.speech.advanced / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">ì‚¬ê³ ë ¥ ì´ì </span>
                                <span class="text-base font-bold text-indigo-600">
                                    {{ latest_result.scores.speech.beginner + latest_result.scores.speech.intermediate + latest_result.scores.speech.advanced }}ì 
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„œìˆ ë ¥ ì˜ì—­ -->
                <div>
                    <div class="font-medium text-gray-700 mb-4 flex items-center gap-2">
                        <span class="text-2xl">âœï¸</span>
                        ì„œìˆ ë ¥ (ê¸€ì“°ê¸° ì—­ëŸ‰)
                    </div>
                    <div class="space-y-3">
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì´ˆê¸‰ (ê°„ê²°í•œ ìš”ì•½)</span>
                                <span class="text-sm font-medium text-pink-600">
                                    {{ latest_result.scores.write.beginner }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-pink-400"
                                     style="width: {{ (latest_result.scores.write.beginner / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ì¤‘ê¸‰ (ì²´ê³„ì  êµ¬ì„±)</span>
                                <span class="text-sm font-medium text-pink-600">
                                    {{ latest_result.scores.write.intermediate }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-pink-500"
                                     style="width: {{ (latest_result.scores.write.intermediate / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm text-gray-600">ê³ ê¸‰ (ì°½ì˜ì  ì¬êµ¬ì„±)</span>
                                <span class="text-sm font-medium text-pink-600">
                                    {{ latest_result.scores.write.advanced }}ì  / 25ì 
                                </span>
                            </div>
                            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-pink-600"
                                     style="width: {{ (latest_result.scores.write.advanced / 25 * 100) }}%"></div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">ì„œìˆ ë ¥ ì´ì </span>
                                <span class="text-base font-bold text-pink-600">
                                    {{ latest_result.scores.write.beginner + latest_result.scores.write.intermediate + latest_result.scores.write.advanced }}ì 
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </details>
        </div>
    </div>

    <!-- êµìœ¡ ì „ëµ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- ê°•ì  -->
        <div class="bg-green-50 border border-green-200 rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-green-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ’ª</span>
                ê°•ì 
            </h4>
            <ul class="space-y-2">
                {% for strength in latest_result.mbti_type.strengths %}
                <li class="flex items-start gap-2 text-green-700">
                    <span class="text-green-600 mt-1">âœ“</span>
                    <span>{{ strength }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- ì•½ì  -->
        <div class="bg-orange-50 border border-orange-200 rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-orange-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">âš ï¸</span>
                ë³´ì™„í•  ì 
            </h4>
            <ul class="space-y-2">
                {% for weakness in latest_result.mbti_type.weaknesses %}
                <li class="flex items-start gap-2 text-orange-700">
                    <span class="text-orange-600 mt-1">â€¢</span>
                    <span>{{ weakness }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- êµìœ¡ íŒ -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ’¡</span>
                êµìœ¡ ì „ëµ
            </h4>
            <ul class="space-y-2">
                {% for tip in latest_result.mbti_type.tips %}
                <li class="flex items-start gap-2 text-blue-700">
                    <span class="text-blue-600 mt-1">â†’</span>
                    <span>{{ tip }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- ìŠ¤íƒ€ì¼ ìƒì„¸ ì„¤ëª… -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- ë…í•´ ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ“–</span>
                ë…í•´ ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ latest_result.mbti_type.reading_style }}
            </p>
        </div>

        <!-- ë°œí‘œ/í† ë¡  ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">ğŸ’¬</span>
                ë°œí‘œ/í† ë¡  ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ latest_result.mbti_type.speaking_style }}
            </p>
        </div>

        <!-- ì“°ê¸° ìŠ¤íƒ€ì¼ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <span class="text-2xl">âœï¸</span>
                ì“°ê¸° ìŠ¤íƒ€ì¼
            </h4>
            <p class="text-gray-700 leading-relaxed">
                {{ latest_result.mbti_type.writing_style }}
            </p>
        </div>
    </div>

    <!-- ê²€ì‚¬ ì´ë ¥ -->
    {% if all_results|length > 1 %}
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-800">ê²€ì‚¬ ì´ë ¥ ({{ all_results|length }}íšŒ)</h3>
        </div>
        <div class="p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ê²€ì‚¬ì¼</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ìœ í˜• ì½”ë“œ</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ìœ í˜•ëª…</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ë…í•´ë ¥</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ì‚¬ê³ ë ¥</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">ì„œìˆ ë ¥</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for result in all_results %}
                        <tr class="hover:bg-gray-50 {% if result.result_id == latest_result.result_id %}bg-purple-50{% endif %}">
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {{ result.created_at.strftime('%Y-%m-%d') }}
                                {% if result.result_id == latest_result.result_id %}
                                <span class="ml-2 px-2 py-1 bg-purple-600 text-white text-xs rounded-full">ìµœì‹ </span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs font-mono rounded">
                                    {{ result.mbti_type.type_code }}
                                </span>
                            </td>
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 bg-purple-100 text-purple-700 text-sm font-medium rounded-full">
                                    {{ result.mbti_type.type_name }}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {% if result.read_type == 'beginner' %}ì´ˆê¸‰
                                {% elif result.read_type == 'intermediate' %}ì¤‘ê¸‰
                                {% else %}ê³ ê¸‰{% endif %}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {% if result.speech_type == 'beginner' %}ì´ˆê¸‰
                                {% elif result.speech_type == 'intermediate' %}ì¤‘ê¸‰
                                {% else %}ê³ ê¸‰{% endif %}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-600">
                                {% if result.write_type == 'beginner' %}ì´ˆê¸‰
                                {% elif result.write_type == 'intermediate' %}ì¤‘ê¸‰
                                {% else %}ê³ ê¸‰{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- ë¯¸ê²€ì‚¬ ìƒíƒœ -->
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <div class="text-6xl mb-4">ğŸ“‹</div>
        <h3 class="text-2xl font-bold text-gray-800 mb-2">ì•„ì§ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600">
            í•™ìƒì—ê²Œ ë…ì„œ ë…¼ìˆ  MBTI ê²€ì‚¬ë¥¼ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
        </p>
    </div>
    {% endif %}
</div>

{% if all_results %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('radarChart').getContext('2d');

    const radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: [
                'ê¸°ë³¸ ë¬¸í•´ë ¥',
                'êµ¬ì¡°ì  ë…í•´',
                'ë¹„íŒì  ë…í•´',
                'ë‚´ìš© ì „ë‹¬',
                'ë…¼ë¦¬ì  í‘œí˜„',
                'ì°½ì˜ì  í™•ì¥',
                'ê°„ê²°í•œ ìš”ì•½',
                'ì²´ê³„ì  êµ¬ì„±',
                'ì°½ì˜ì  ì¬êµ¬ì„±'
            ],
            datasets: [{
                label: 'í•™ìƒ ì ìˆ˜',
                data: [
                    {{ latest_result.scores.read.beginner }},
                    {{ latest_result.scores.read.intermediate }},
                    {{ latest_result.scores.read.advanced }},
                    {{ latest_result.scores.speech.beginner }},
                    {{ latest_result.scores.speech.intermediate }},
                    {{ latest_result.scores.speech.advanced }},
                    {{ latest_result.scores.write.beginner }},
                    {{ latest_result.scores.write.intermediate }},
                    {{ latest_result.scores.write.advanced }}
                ],
                fill: true,
                backgroundColor: 'rgba(147, 51, 234, 0.2)',
                borderColor: 'rgb(147, 51, 234)',
                pointBackgroundColor: 'rgb(147, 51, 234)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(147, 51, 234)',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 25,
                    min: 0,
                    ticks: {
                        stepSize: 5,
                        font: {
                            size: 12
                        }
                    },
                    pointLabels: {
                        font: {
                            size: 13,
                            weight: 'bold'
                        },
                        color: '#374151'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    angleLines: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        label: function(context) {
                            return 'ì ìˆ˜: ' + context.parsed.r + 'ì  / 25ì ';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
