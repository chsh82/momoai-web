{% extends "base.html" %}

{% block title %}{{ board.title }} - ê°•ì‚¬ ê²Œì‹œíŒ{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="{{ url_for('teacher.board') }}"
           class="text-blue-600 hover:text-blue-800 font-medium mb-2 inline-block">
            â† ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="mb-6 p-4 rounded-lg {% if category == 'error' %}bg-red-100 text-red-700 border border-red-300{% elif category == 'success' %}bg-green-100 text-green-700 border border-green-300{% else %}bg-blue-100 text-blue-700 border border-blue-300{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- ê²Œì‹œê¸€ -->
    <div class="bg-white rounded-lg shadow">
        <!-- ì œëª© ì˜ì—­ -->
        <div class="px-8 py-6 border-b border-gray-200">
            <div class="flex items-center gap-2 mb-3">
                {% if board.is_notice %}
                <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded">ê³µì§€</span>
                {% endif %}
                <h1 class="text-2xl font-bold text-gray-800">{{ board.title }}</h1>
            </div>
            <div class="flex items-center justify-between text-sm text-gray-600">
                <div class="flex items-center gap-4">
                    <span>ğŸ‘¤ {{ board.author.name }}</span>
                    <span>ğŸ“… {{ board.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    <span>ğŸ‘ï¸ {{ board.view_count }}</span>
                </div>
                {% if board.author_id == current_user.user_id or current_user.is_admin %}
                <div class="flex gap-2">
                    <a href="{{ url_for('teacher.board_edit', board_id=board.board_id) }}"
                       class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded transition duration-200">
                        ìˆ˜ì •
                    </a>
                    <form method="POST" action="{{ url_for('teacher.board_delete', board_id=board.board_id) }}"
                          onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
                          class="inline">
                        <button type="submit"
                                class="bg-red-600 hover:bg-red-700 text-white text-sm px-4 py-2 rounded transition duration-200">
                            ì‚­ì œ
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ë‚´ìš© ì˜ì—­ -->
        <div class="px-8 py-6">
            <div class="prose max-w-none">
                {{ board.content | safe }}
            </div>
        </div>

        <!-- ì²¨ë¶€íŒŒì¼ ì˜ì—­ -->
        {% if board.attachment_count > 0 %}
        <div class="px-8 py-6 border-t border-gray-200 bg-gray-50">
            <h3 class="font-semibold text-gray-800 mb-4">ğŸ“ ì²¨ë¶€íŒŒì¼ ({{ board.attachment_count }}ê°œ)</h3>

            <!-- ì´ë¯¸ì§€ ì²¨ë¶€íŒŒì¼ -->
            {% set images = board.image_attachments %}
            {% if images %}
            <div class="mb-6">
                <h4 class="text-sm font-medium text-gray-700 mb-3">ğŸ–¼ï¸ ì´ë¯¸ì§€</h4>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {% for attachment in images %}
                    <div class="relative group">
                        <img src="/uploads/{{ attachment.file_path }}"
                             alt="{{ attachment.original_filename }}"
                             class="w-full h-48 object-cover rounded-lg border border-gray-300 cursor-pointer hover:opacity-90 transition"
                             onclick="openImageModal('{{ attachment.original_filename }}', '/uploads/{{ attachment.file_path }}')">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-2 rounded-b-lg opacity-0 group-hover:opacity-100 transition">
                            {{ attachment.original_filename }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- ì¼ë°˜ íŒŒì¼ ì²¨ë¶€íŒŒì¼ -->
            {% set files = board.file_attachments %}
            {% if files %}
            <div>
                <h4 class="text-sm font-medium text-gray-700 mb-3">ğŸ“„ íŒŒì¼</h4>
                <div class="space-y-2">
                    {% for attachment in files %}
                    <a href="{{ url_for('teacher.board_attachment_download', attachment_id=attachment.attachment_id) }}"
                       class="flex items-center justify-between p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ“„</span>
                            <div>
                                <p class="font-medium text-gray-800">{{ attachment.original_filename }}</p>
                                <p class="text-xs text-gray-500">
                                    {{ (attachment.file_size / 1024) | round(1) }} KB
                                    Â· {{ attachment.uploaded_at.strftime('%Y-%m-%d') }}
                                </p>
                            </div>
                        </div>
                        <span class="text-blue-600 text-sm">ë‹¤ìš´ë¡œë“œ â†“</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
<div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4"
     onclick="closeImageModal()">
    <div class="max-w-6xl max-h-full">
        <div class="bg-white rounded-lg p-4">
            <div class="flex items-center justify-between mb-4">
                <h3 id="modalImageTitle" class="font-semibold text-gray-800"></h3>
                <button onclick="closeImageModal()" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
            </div>
            <img id="modalImage" src="" alt="" class="max-w-full max-h-[80vh] object-contain rounded">
        </div>
    </div>
</div>

<script>
function openImageModal(title, src) {
    document.getElementById('modalImageTitle').textContent = title;
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModal').classList.remove('hidden');
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

// ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeImageModal();
    }
});
</script>
{% endblock %}
