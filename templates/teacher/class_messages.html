{% extends "base.html" %}

{% block title %}ìˆ˜ì—… ê³µì§€/ê³¼ì œ - MOMOAI v4.0{% endblock %}

{% block page_title %}ğŸ’¬ ìˆ˜ì—… ê³µì§€/ê³¼ì œ{% endblock %}

{% block page_subtitle %}
<span class="text-sm text-white text-opacity-70 ml-3">í•™ìƒ ë©”ì‹œì§€ ë°œì†¡</span>
{% endblock %}


{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <h2 class="text-3xl font-bold text-gray-800">ğŸ“¢ ìˆ˜ì—… ê³µì§€ ë° ê³¼ì œ ë©”ì‹œì§€</h2>
        <p class="text-gray-600 mt-2">ë°˜ ì „ì²´ ë˜ëŠ” ê°œë³„ í•™ìƒì—ê²Œ ê³µì§€ë‚˜ ê³¼ì œë¥¼ ì „ë‹¬í•˜ì„¸ìš”.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- ë°˜ë³„ ê³µì§€ ë°œì†¡ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">ğŸ‘¥</span>
                <h3 class="text-xl font-bold text-gray-800">ë°˜ ì „ì²´ ê³µì§€</h3>
            </div>

            <form method="POST" action="{{ url_for('teacher.send_course_message') }}" id="courseMessageForm">
                <!-- ìˆ˜ì—… ì„ íƒ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ìˆ˜ì—… ì„ íƒ</label>
                    <select name="course_id" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">ìˆ˜ì—…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        {% for course in courses %}
                        <option value="{{ course.course_id }}">
                            {{ course.course_name }} ({{ course.enrollments|length }}ëª…)
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- ë©”ì‹œì§€ ìœ í˜• -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ìœ í˜•</label>
                    <select name="message_type" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="announcement">ìˆ˜ì—… ê³µì§€</option>
                        <option value="homework">ê³¼ì œ ì•ˆë‚´</option>
                    </select>
                </div>

                <!-- ì œëª© -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
                    <input type="text" name="title" required maxlength="100"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="ì˜ˆ: ë‹¤ìŒ ì£¼ ìˆ˜ì—… ì•ˆë‚´">
                </div>

                <!-- ë‚´ìš© -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë‚´ìš©</label>
                    <textarea name="message" required rows="5"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="í•™ìƒë“¤ì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>

                <!-- í•™ë¶€ëª¨ ë°œì†¡ ì˜µì…˜ -->
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="send_to_parents" value="1" checked
                               class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">í•™ë¶€ëª¨ì—ê²Œë„ í•¨ê»˜ ë°œì†¡</span>
                    </label>
                    <p class="text-xs text-gray-500 mt-1 ml-6">ì²´í¬ í•´ì œ ì‹œ í•™ìƒì—ê²Œë§Œ ë°œì†¡ë©ë‹ˆë‹¤</p>
                </div>

                <!-- ë°œì†¡ ë²„íŠ¼ -->
                <button type="submit"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-200">
                    ë°˜ ì „ì²´ì— ë°œì†¡í•˜ê¸°
                </button>
            </form>
        </div>

        <!-- ê°œë³„ í•™ìƒ ë©”ì‹œì§€ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex items-center mb-4">
                <span class="text-3xl mr-3">ğŸ‘¤</span>
                <h3 class="text-xl font-bold text-gray-800">ê°œë³„ í•™ìƒ ë©”ì‹œì§€</h3>
            </div>

            <form method="POST" action="{{ url_for('teacher.send_student_message') }}" id="studentMessageForm">
                <!-- í•™ìƒ ì„ íƒ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">í•™ìƒ ì„ íƒ</label>
                    <select name="student_id" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”</option>
                        {% for student in students %}
                        <option value="{{ student.student_id }}">
                            {{ student.name }} ({{ student.grade }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- ë©”ì‹œì§€ ìœ í˜• -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ìœ í˜•</label>
                    <select name="message_type" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="homework">ê°œë³„ ê³¼ì œ</option>
                        <option value="announcement">ê°œë³„ ë©”ì‹œì§€</option>
                    </select>
                </div>

                <!-- ì œëª© -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
                    <input type="text" name="title" required maxlength="100"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="ì˜ˆ: ì¶”ê°€ ê³¼ì œ ì•ˆë‚´">
                </div>

                <!-- ë‚´ìš© -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë‚´ìš©</label>
                    <textarea name="message" required rows="5"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                              placeholder="í•™ìƒì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>

                <!-- í•™ë¶€ëª¨ ë°œì†¡ ì˜µì…˜ -->
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="send_to_parents" value="1" checked
                               class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                        <span class="ml-2 text-sm text-gray-700">í•™ë¶€ëª¨ì—ê²Œë„ í•¨ê»˜ ë°œì†¡</span>
                    </label>
                    <p class="text-xs text-gray-500 mt-1 ml-6">ì²´í¬ í•´ì œ ì‹œ í•™ìƒì—ê²Œë§Œ ë°œì†¡ë©ë‹ˆë‹¤</p>
                </div>

                <!-- ë°œì†¡ ë²„íŠ¼ -->
                <button type="submit"
                        class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors duration-200">
                    í•™ìƒì—ê²Œ ë°œì†¡í•˜ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- ìµœê·¼ ë°œì†¡ ë‚´ì—­ -->
    {% if recent_messages %}
    <div class="bg-white rounded-lg shadow">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-lg font-bold text-gray-800">ğŸ“ ìµœê·¼ ë°œì†¡ ë‚´ì—­</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ë‚ ì§œ
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ìœ í˜•
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ì œëª©
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            ë‚´ìš©
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for msg in recent_messages %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ msg.created_at.strftime('%m/%d %H:%M') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if msg.notification_type == 'class_announcement' %}
                            <span class="px-2 py-1 text-xs font-medium rounded bg-blue-100 text-blue-800">
                                ê³µì§€
                            </span>
                            {% elif msg.notification_type == 'homework_assignment' %}
                            <span class="px-2 py-1 text-xs font-medium rounded bg-green-100 text-green-800">
                                ê³¼ì œ
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">
                            {{ msg.title }}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700">
                            <div class="max-w-md truncate">{{ msg.message }}</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <div class="text-6xl mb-4">ğŸ“­</div>
        <p class="text-gray-500 text-lg">ì•„ì§ ë°œì†¡í•œ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}

    <!-- ë„ì›€ë§ -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start">
            <span class="text-2xl mr-3">ğŸ’¡</span>
            <div>
                <p class="text-sm text-blue-900 font-medium mb-1">ìˆ˜ì—… ê³µì§€/ê³¼ì œ ì•ˆë‚´</p>
                <ul class="text-sm text-blue-800 space-y-1">
                    <li>â€¢ <strong>ë°˜ ì „ì²´ ê³µì§€:</strong> í•´ë‹¹ ìˆ˜ì—…ì˜ ëª¨ë“  í•™ìƒê³¼ í•™ë¶€ëª¨ì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤</li>
                    <li>â€¢ <strong>ê°œë³„ í•™ìƒ ë©”ì‹œì§€:</strong> íŠ¹ì • í•™ìƒê³¼ í•´ë‹¹ í•™ìƒì˜ í•™ë¶€ëª¨ì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤</li>
                    <li>â€¢ ë°œì†¡ëœ ë©”ì‹œì§€ëŠ” í•™ìƒ/í•™ë¶€ëª¨ í¬í„¸ì˜ ì•Œë¦¼í•¨ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// í¼ ì œì¶œ í™•ì¸
document.getElementById('courseMessageForm').addEventListener('submit', function(e) {
    const courseName = this.querySelector('select[name="course_id"] option:checked').text;
    if (!confirm(`${courseName}ì˜ ì „ì²´ í•™ìƒì—ê²Œ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        e.preventDefault();
    }
});

document.getElementById('studentMessageForm').addEventListener('submit', function(e) {
    const studentName = this.querySelector('select[name="student_id"] option:checked').text;
    if (!confirm(`${studentName}ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
