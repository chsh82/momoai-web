# Excel 일괄 임포트 사용 가이드 📤

## 🎯 개요

구글 설문 결과 Excel 파일을 업로드하면 **자동으로 모든 학생 프로필을 생성**합니다.

---

## 📋 사전 준비

### 1. 학생 등록 확인
Excel의 학생 이름이 시스템에 등록되어 있어야 합니다.
- 시스템 학생 이름과 **정확히 일치**해야 합니다
- 예: Excel "김지원" = 시스템 "김지원" ✅
- 예: Excel "김지원" ≠ 시스템 "김지 원" ❌

### 2. Excel 파일 준비
- **파일 형식**: .xlsx 또는 .xls
- **필수 컬럼**: "1. 학생의 이름"
- **현재 파일**: `C:\Users\aproa\Downloads\3. 학생 기초 조사응답_원고지택배(2025).xlsx`
  - 총 124개 응답
  - 123명 고유 학생
  - 23개 컬럼

---

## 🚀 임포트 방법

### 웹 인터페이스 사용

#### Step 1: 메뉴 접근
```
Admin 로그인
  ↓
학생 관리
  ↓
📋 학생 프로필
  ↓
"Excel 일괄 임포트" 버튼 클릭
```

#### Step 2: 파일 업로드
1. "Excel 파일 선택" 버튼 클릭
2. 파일 선택: `3. 학생 기초 조사응답_원고지택배(2025).xlsx`
3. "업로드 및 임포트" 버튼 클릭

#### Step 3: 처리 대기
- 처리 중 메시지 표시: "⏳ 처리 중... (최대 1-2분 소요)"
- 브라우저 창을 닫지 마세요

#### Step 4: 결과 확인
- 성공: "성공: N건, 실패: M건"
- 에러가 있으면 에러 목록 표시 (최대 50개)

---

## 📊 자동 매핑되는 데이터 (23개 항목)

### 기본 정보
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 타임스탬프 | survey_date | 설문 작성일 |
| 1. 학생의 이름 | (검색용) | 학생 매칭 키 |
| 4. 주소(...) | address | 주소 |
| 5. 학부모 연락처 | parent_contact | 연락처 |
| 6. 재학 중인 학교 이름 | current_school | 학교명 |

### 독서 경험 및 역량
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 8. 독서논술 수업 경험 및 기간 | reading_experience | 경험 기간 |
| 9. 부모님이 느끼시는 학생의 독서역량을 체크해주세요. | reading_competency | 1-5 점수 |
| 10. 학생의 한 주 평균 독서량을 체크해주세요. | weekly_reading_amount | 주간 독서량 |
| 11. 학생이 선호하는 독서 분야를 모두 선택해주세요. | preferred_genres | JSON 배열 |

### 학생 성향
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 12. 학생의 성향을 모두 알려주세요. | personality_traits | JSON 배열 |

### 수업 목표
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 13. 모모의 책장 수업에서 가장 향상시키고 싶으신 부분은 무엇입니까? (최우선 요소 1개만 선택 가능) | main_improvement_goal | 주요 목표 |
| 17. 가장 선호하는 수업 목표를 선택해주세요. (1개만 선택 가능) | preferred_class_style | 선호 스타일 |
| 18. 선생님께 수업에 관해 요청드리고 싶은 부분이 있다면 적어주세요. | teacher_request | 강사 요청 |

### 유입 경로
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 19. 모모의 책장을 어떻게 알게 되셨나요? | referral_source | 유입 경로 |

### 진로/진학 정보
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 1. 필요한 교육&입시 정보가 있으신가요? | education_info_needs | JSON 배열 |
| 2. 진학 목표가 있으신가요? | academic_goals | JSON 배열 |
| 3. 관심 있는 학생의 진로 분야는 무엇입니까? | career_interests | JSON 배열 |
| 4. 기타 교육분야 관심사항이 있으시면 모두 적어주세요. | other_interests | 기타 관심 |

### 가족 정보
| Excel 컬럼 | 시스템 필드 | 설명 |
|-----------|------------|------|
| 형제/자매 정보를 입력해주세요. | sibling_info | 형제자매 |

---

## 🔍 처리 로직

### 각 행(응답)마다:

```python
1. "1. 학생의 이름" 컬럼에서 학생 이름 추출
   ↓
2. 시스템에서 해당 이름의 학생 검색
   ↓
3. 학생이 존재하는가?
   ├─ YES → 4번으로
   └─ NO → 에러 기록: "학생을 찾을 수 없습니다"
   ↓
4. 이미 프로필이 있는가?
   ├─ YES → 에러 기록: "프로필이 이미 존재합니다"
   └─ NO → 5번으로
   ↓
5. 데이터 파싱 및 변환
   - 쉼표로 구분된 다중 선택 → JSON 배열
   - 독서역량 문자열 → 숫자 변환
   - 연락처 문자열 변환
   ↓
6. StudentProfile 객체 생성 및 저장
   ↓
7. 성공 카운트 증가
```

### 최종 결과:
- **성공 건수**: 프로필이 생성된 학생 수
- **실패 건수**: 에러가 발생한 행 수
- **에러 로그**: 실패한 행과 이유 (최대 50개)

---

## ⚠️ 주의사항

### 1. 학생 이름 정확성
- ❌ 잘못된 예:
  ```
  Excel: "김지원" → 시스템: "김지 원" (공백 차이)
  Excel: "이영희" → 시스템: "이 영희" (공백 차이)
  ```
- ✅ 올바른 예:
  ```
  Excel: "김지원" → 시스템: "김지원" (정확히 일치)
  ```

### 2. 중복 처리
- 이미 프로필이 있는 학생은 **자동으로 건너뜁니다**
- 기존 프로필을 업데이트하지 않습니다
- 수정이 필요하면 **개별 수정 기능** 사용

### 3. 대용량 처리
- 100건 이상: 1-2분 소요 가능
- 처리 중 브라우저 창을 닫지 마세요
- 완료될 때까지 기다려주세요

### 4. 에러 처리
- 에러 발생 시 해당 행은 건너뛰고 계속 진행
- 에러 로그에서 실패 이유 확인
- 실패한 학생은 개별적으로 프로필 생성

---

## 📈 예상 결과 (현재 파일 기준)

현재 Excel 파일: `3. 학생 기초 조사응답_원고지택배(2025).xlsx`
- **총 응답**: 124건
- **고유 학생**: 123명

### 시나리오 1: 모든 학생이 등록되어 있고 프로필이 없는 경우
```
✅ 성공: 123건
❌ 실패: 0건
```

### 시나리오 2: 일부 학생이 미등록되거나 프로필이 있는 경우
```
✅ 성공: 100건
❌ 실패: 23건

에러 로그:
- 행 5: 학생 "김철수"를 찾을 수 없습니다.
- 행 12: 학생 "이영희"의 프로필이 이미 존재합니다.
- 행 23: 학생 "박민수"를 찾을 수 없습니다.
...
```

---

## 🛠️ 문제 해결

### Q1: "학생을 찾을 수 없습니다" 에러
**원인**: Excel의 학생 이름이 시스템에 등록되지 않았거나 이름이 다릅니다.

**해결책**:
1. 시스템에서 학생 이름 확인
2. Excel과 시스템의 이름이 정확히 일치하는지 확인
3. 공백, 특수문자 등 확인
4. 필요시 학생 먼저 등록 후 재시도

### Q2: "프로필이 이미 존재합니다" 에러
**원인**: 해당 학생의 프로필이 이미 생성되어 있습니다.

**해결책**:
1. 의도된 경우: 무시 (중복 생성 방지)
2. 업데이트가 필요한 경우: 개별 수정 기능 사용
3. 재생성이 필요한 경우: 기존 프로필 삭제 후 재임포트

### Q3: 처리가 너무 오래 걸립니다
**원인**: 대용량 데이터 또는 서버 성능

**해결책**:
1. 최대 2분까지 기다려주세요
2. 브라우저 콘솔에서 오류 확인
3. 필요시 파일을 여러 개로 분할하여 임포트

### Q4: 일부 데이터가 누락되었습니다
**원인**: Excel 컬럼 이름이 변경되었거나 데이터 형식이 잘못됨

**해결책**:
1. Excel 컬럼 이름이 원본 구글 설문과 동일한지 확인
2. 누락된 데이터는 개별 수정 기능으로 추가
3. 데이터 형식 확인 (숫자, 날짜 등)

---

## 💡 팁

### 1. 사전 확인
임포트 전에 학생 목록을 먼저 확인하세요:
```
Admin → 학생 관리 → 학생 프로필
→ 학생 목록에서 등록 여부 확인
```

### 2. 테스트 임포트
처음 사용할 때는 일부 학생만으로 테스트:
1. Excel에서 상위 10개 행만 복사
2. 새 파일로 저장
3. 테스트 임포트
4. 결과 확인 후 전체 임포트

### 3. 백업
임포트 전 데이터베이스 백업 권장:
```bash
cp momoai.db momoai.db.backup
```

### 4. 일괄 처리 전략
- **Phase 1**: 학생 등록 (Admin → 학생 관리)
- **Phase 2**: Excel 임포트 (프로필 생성)
- **Phase 3**: 에러 학생 개별 처리
- **Phase 4**: 프로필 검증 및 보완

---

## 📞 문제 발생 시

1. **에러 로그 저장**: 화면에 표시된 에러 목록 복사
2. **Excel 파일 확인**: 실패한 행의 데이터 검토
3. **학생 등록 확인**: 시스템에 학생이 등록되어 있는지 확인
4. **개별 처리**: 실패한 학생은 개별 프로필 생성 기능 사용

---

## ✅ 체크리스트

임포트 전 확인사항:
- [ ] 모든 학생이 시스템에 등록되어 있나요?
- [ ] Excel 파일이 .xlsx 또는 .xls 형식인가요?
- [ ] "1. 학생의 이름" 컬럼이 있나요?
- [ ] 학생 이름이 시스템과 정확히 일치하나요?
- [ ] 중복 프로필이 생성되지 않도록 확인했나요?
- [ ] 데이터베이스 백업을 했나요? (선택)

---

**모든 준비가 완료되면 Excel 임포트를 시작하세요!** 🚀
