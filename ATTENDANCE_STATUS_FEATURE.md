# 전체 출석현황 페이지 구현 완료

## 📋 구현 내용

### 기능 개요
관리자가 **반별/개인별 출석 현황**을 한눈에 확인할 수 있는 통합 대시보드가 구현되었습니다.

## 🎯 주요 기능

### 1. 다양한 검색 필터

#### 📅 날짜 범위 선택
- 시작일 ~ 종료일 지정
- 기본값: 최근 30일
- 원하는 기간 자유롭게 설정

#### 📚 수업 (반) 필터
- 드롭다운에서 수업 선택
- 선택한 수업의 출석 현황만 표시
- "전체 수업" 선택 시 모든 수업 포함

#### 👥 학생 (개인) 필터
- 드롭다운에서 학생 선택
- 선택한 학생의 모든 출석 기록 표시
- 이름 + 학년 표시

#### 📊 출석 상태 필터
- 출석/지각/결석/인정결석 선택
- 특정 상태만 필터링

### 2. 전체 통계 대시보드 (6개 카드)

#### 숫자 통계
1. **전체**: 총 출석 레코드 수
2. **출석**: 출석 처리된 수 (초록색)
3. **지각**: 지각 처리된 수 (노란색)
4. **결석**: 결석 처리된 수 (빨간색)
5. **인정결석**: 인정결석 수 (파란색)
6. **출석률**: 전체 출석률 % (보라색)

### 3. 반별 출석 현황 (상위 10개)

#### 표시 항목
- 수업명 (클릭 시 해당 반 필터 적용)
- 전체 출석 수
- 출석/지각/결석 분류
- 출석률 (색상 구분)

#### 출석률 색상
- **80% 이상**: 초록색 (우수)
- **60-79%**: 노란색 (보통)
- **60% 미만**: 빨간색 (미흡)

### 4. 학생별 출석 현황 (상위 20명)

#### 표시 항목
- 학생명 (클릭 시 해당 학생 필터 적용)
- 학년
- 전체 출석 수
- 출석/지각/결석 분류
- 출석률 (색상 구분)

### 5. 상세 출석 기록 (최근 100개)

#### 테이블 컬럼
1. **날짜**: 세션 날짜 (YYYY-MM-DD)
2. **수업**: 수업명 + 세션 번호
3. **학생**: 학생 이름
4. **학년**: 학년 정보
5. **출석 상태**: 색상 배지
6. **체크 시간**: 출석 체크한 시간
7. **메모**: 출석 관련 메모

### 6. 필터 조합 기능

#### 가능한 조합
- 날짜 범위만
- 날짜 + 수업
- 날짜 + 학생
- 날짜 + 수업 + 학생
- 날짜 + 상태
- 모든 필터 조합

## 📂 수정/생성된 파일

### 신규 생성
1. **`templates/admin/attendance_status.html`**
   - 전체 출석현황 페이지
   - 필터 섹션
   - 통계 대시보드
   - 반별/학생별 통계 테이블
   - 상세 출석 기록

2. **`ATTENDANCE_STATUS_FEATURE.md`**
   - 이 문서

### 수정된 파일
1. **`app/admin/routes.py`**
   - `@admin_bp.route('/attendance-status')` 추가
   - `attendance_status()` 함수 구현
   - 복잡한 필터 쿼리 로직
   - 통계 계산 로직

2. **`templates/base.html`**
   - 관리자 메뉴에 "📊 전체 출석현황" 링크 추가

## 🚀 사용 방법

### 기본 사용

#### 1. 전체 출석 현황 보기
```
1. 관리자 로그인
2. 좌측 사이드바 → 관리자 → 📊 전체 출석현황
3. 기본 화면 (최근 30일 전체 데이터)
   - 전체 통계 카드 확인
   - 반별 통계 (상위 10개)
   - 학생별 통계 (상위 20명)
   - 상세 출석 기록 (최근 100개)
```

### 반별 검색

#### 2. 특정 수업(반)의 출석 현황
```
1. "수업 (반)" 드롭다운 선택
2. 원하는 수업 선택 (예: "초3 베이직 월 14:00 - 김선희")
3. "🔍 검색" 버튼 클릭
4. 결과:
   - 해당 수업의 전체 통계
   - 해당 수업 학생들의 출석 현황
   - 해당 수업의 상세 출석 기록
```

#### 통계에서 클릭하여 검색
```
1. 반별 통계 테이블에서 수업명 클릭
2. 자동으로 해당 수업 필터 적용
3. 해당 수업의 상세 현황 표시
```

### 개인별 검색

#### 3. 특정 학생의 출석 현황
```
1. "학생" 드롭다운 선택
2. 원하는 학생 선택 (예: "김민준 (초3)")
3. "🔍 검색" 버튼 클릭
4. 결과:
   - 해당 학생의 전체 출석 통계
   - 해당 학생이 수강하는 모든 수업의 기록
   - 날짜별 상세 출석 기록
```

#### 통계에서 클릭하여 검색
```
1. 학생별 통계 테이블에서 학생명 클릭
2. 자동으로 해당 학생 필터 적용
3. 해당 학생의 상세 현황 표시
```

### 기간별 검색

#### 4. 특정 기간의 출석 현황
```
1. "시작일" 선택 (예: 2026-01-01)
2. "종료일" 선택 (예: 2026-01-31)
3. "🔍 검색" 버튼 클릭
4. 해당 기간의 출석 현황 표시
```

### 조합 검색

#### 5. 특정 수업의 특정 기간 출석 현황
```
1. 날짜 범위 선택
2. 수업 선택
3. "🔍 검색"
→ 해당 수업의 해당 기간 출석 현황
```

#### 6. 특정 학생의 특정 수업 출석 현황
```
1. 수업 선택
2. 학생 선택
3. "🔍 검색"
→ 해당 학생의 해당 수업 출석 현황만
```

#### 7. 결석만 조회
```
1. "출석 상태" → "결석" 선택
2. "🔍 검색"
→ 결석 기록만 표시
→ 출석 관리 필요한 학생 파악
```

## 🎨 UI/UX 디자인

### 필터 섹션
- **레이아웃**: 5열 그리드 (반응형)
- **입력 필드**: 날짜 선택기, 드롭다운
- **버튼**: 파란색 "검색", 회색 "초기화"

### 통계 카드
- **6개 카드**: 2행 6열 그리드
- **색상 구분**: 회색(전체), 초록(출석), 노랑(지각), 빨강(결석), 파랑(인정), 보라(출석률)
- **큰 숫자**: 한눈에 파악

### 통계 테이블
- **반별**: 좌측 (lg 화면에서 절반)
- **학생별**: 우측 (lg 화면에서 절반)
- **클릭 가능**: 파란색 링크
- **호버 효과**: 회색 배경

### 상세 기록 테이블
- **전체 너비**: 가로 스크롤 지원
- **상태 배지**: 색상별 구분
- **필터 표시**: 상단에 필터 적용 상태 표시

## 📊 데이터 처리 로직

### 쿼리 구조
```python
# 1. 기본 쿼리
query = Attendance.query.join(CourseSession).join(Course).join(Student)

# 2. 필터 적용
if date_from:
    query = query.filter(CourseSession.session_date >= date_from)
if date_to:
    query = query.filter(CourseSession.session_date <= date_to)
if course_filter:
    query = query.filter(Course.course_id == course_filter)
if student_filter:
    query = query.filter(Student.student_id == student_filter)
if status_filter:
    query = query.filter(Attendance.status == status_filter)

# 3. 정렬 및 제한
query.order_by(session_date.desc()).limit(100)
```

### 통계 계산
```python
# 전체 카운트
total_count = query.count()
present_count = query.filter(status == 'present').count()
late_count = query.filter(status == 'late').count()
absent_count = query.filter(status == 'absent').count()

# 출석률
attendance_rate = (present_count / total_count * 100) if total_count > 0 else 0
```

### 반별 통계
```sql
SELECT
    course_id,
    course_name,
    COUNT(*) as total,
    SUM(CASE WHEN status='present' THEN 1 ELSE 0 END) as present,
    SUM(CASE WHEN status='late' THEN 1 ELSE 0 END) as late,
    SUM(CASE WHEN status='absent' THEN 1 ELSE 0 END) as absent
FROM attendance
JOIN course_session ON ...
JOIN course ON ...
GROUP BY course_id, course_name
ORDER BY total DESC
LIMIT 10
```

## 🧪 테스트 시나리오

### Scenario 1: 전체 현황 확인
```
① 관리자 로그인
② 📊 전체 출석현황 클릭
③ 기본 화면 확인 (최근 30일)
④ 6개 통계 카드 확인
⑤ 반별 통계 상위 10개 확인
⑥ 학생별 통계 상위 20명 확인
⑦ 상세 기록 100개 확인
```

### Scenario 2: 특정 반 출석 현황
```
① 전체 출석현황 페이지
② "수업 (반)" 드롭다운 선택
③ "초3 베이직 월 14:00 - 김선희" 선택
④ "🔍 검색" 클릭
⑤ 해당 반의 통계 확인
⑥ 해당 반 학생들의 출석 현황 확인
⑦ 출석률 낮은 학생 파악
```

### Scenario 3: 특정 학생 추적
```
① 전체 출석현황 페이지
② "학생" 드롭다운에서 "김민준 (초3)" 선택
③ "🔍 검색" 클릭
④ 김민준 학생의 전체 출석 통계 확인
⑤ 여러 수업에서의 출석 패턴 파악
⑥ 결석이 많은 수업 확인
```

### Scenario 4: 통계에서 드릴다운
```
① 반별 통계에서 출석률 낮은 반 클릭
② 자동으로 해당 반 필터 적용
③ 해당 반의 상세 현황 확인
④ 문제 학생 파악
⑤ 학생별 통계에서 해당 학생 클릭
⑥ 해당 학생의 전체 출석 기록 확인
```

### Scenario 5: 결석 학생 관리
```
① "출석 상태" → "결석" 선택
② 최근 30일 결석 기록 조회
③ 반복적으로 결석하는 학생 파악
④ 해당 학생 선택하여 상세 조회
⑤ 학부모 연락 등 후속 조치
```

### Scenario 6: 월간 리포트 생성
```
① 시작일: 2026-01-01
② 종료일: 2026-01-31
③ "🔍 검색"
④ 1월 전체 출석 현황 확인
⑤ 반별 출석률 비교
⑥ 우수 학생/미흡 학생 파악
⑦ 데이터 기반 의사결정
```

## 📝 향후 개선 가능 사항

- [ ] 엑셀/CSV 내보내기 기능
- [ ] 출석률 그래프/차트 시각화
- [ ] 학년별 집계 추가
- [ ] 요일별/시간대별 출석 패턴 분석
- [ ] 출석률 추이 그래프 (시계열)
- [ ] 자동 리포트 이메일 발송
- [ ] 출석률 경고 알림 (임계값 설정)
- [ ] 인쇄용 레포트 생성
- [ ] 월간/분기별/연간 비교
- [ ] 학생 그룹별 통계

## 🎯 핵심 가치

### 관리자 관점
- ✨ 한 페이지에서 전체 출석 현황 파악
- ✨ 반별/개인별 드릴다운 분석
- ✨ 출석률 기반 의사결정
- ✨ 문제 학생 조기 발견

### 데이터 분석
- ✨ 날짜 범위 자유롭게 설정
- ✨ 다양한 필터 조합
- ✨ 통계에서 바로 상세 조회
- ✨ 최근 100개 레코드 확인

### 학생 관리
- ✨ 출석률 낮은 학생 파악
- ✨ 개인별 출석 패턴 분석
- ✨ 조기 개입 가능
- ✨ 학부모 상담 자료

## 🔗 관련 기능

### 연동된 기능
1. **출석 체크** - 출석 데이터 생성
2. **수업 관리** - 수업별 출석 통계
3. **학생 관리** - 학생별 출석 통계
4. **세션 관리** - 세션별 출석 기록

### 데이터 모델
- **Attendance**: 출석 레코드
- **CourseSession**: 세션 정보
- **Course**: 수업 정보
- **Student**: 학생 정보

## 💡 사용 팁

1. **반별 비교**: 같은 기간 여러 반의 출석률 비교로 우수 반 파악
2. **개인 추적**: 특정 학생의 장기 출석 패턴 모니터링
3. **결석 관리**: 결석 필터로 즉시 문제 상황 파악
4. **통계 클릭**: 테이블에서 이름 클릭으로 빠른 드릴다운
5. **기간 설정**: 학기별, 월별 리포트 생성에 활용

## 📈 활용 사례

### 1. 월말 리포트
- 날짜: 해당 월 1일 ~ 말일
- 필터: 전체
- 결과: 월간 전체 출석 현황

### 2. 문제 학생 파악
- 상태: 결석
- 기간: 최근 30일
- 결과: 자주 결석하는 학생 리스트

### 3. 반별 성과 비교
- 기간: 학기 시작 ~ 현재
- 필터: 전체 수업
- 결과: 반별 출석률 순위

### 4. 개인 상담 준비
- 학생: 특정 학생 선택
- 기간: 최근 3개월
- 결과: 해당 학생의 전체 출석 이력

---

**구현 완료:** 2026-02-09
**개발자:** Claude Sonnet 4.5
**버전:** MOMOAI v4.0

**테스트 상태:**
- ✅ 라우트 및 쿼리 로직 구현 완료
- ✅ 템플릿 생성 완료
- ✅ 필터 기능 완료
- ✅ 통계 계산 완료
- ✅ 관리자 메뉴 링크 추가
- 🔄 서버 실행 중 - 테스트 가능
